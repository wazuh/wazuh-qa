# Tests vulnerability detector

Wazuh is able to detect vulnerabilities in the applications installed in agents using the `Vulnerability Detector`
module. This software audit is performed through the integration of vulnerability feeds indexed by `Canonical`,
`Debian`, `Red Hat`, and the `National Vulnerability Database`.

This directory includes all the integration tests developed to test the correct functioning of this module.

These tests can be classified into the following:

- **[test_feeds](test_feeds)**: Tests that check the behavior of the vulnerability detector when a feed with an
unexpected content/type is imported, feeds downloads...

- **[test_general_settings](test_general_settings)**:  Tests that check the basic configuration of the vulnerability
detector in the `ossec.conf`.

- **[test_providers](test_providers)** Tests that check the configuration of the vulnerability detector providers in
the `ossec.conf`.

- **[test_scan_results](test_scan_results)** Tests that check if the vulnerability detector generates alerts in the
appropriate cases.

## Tiers

### Tier 0

#### Test general settings

- **[test_general_settings_enabled](./doc/test_general_settings/test_general_settings_enabled.md)** Tests that are
based on modifying the value of `enabled` tag in `ossec.conf` and checking the result in `ossec.log`.

- **[test_general_settings_ignore_time](./doc/test_general_settings/test_general_settings_ignore_time.md)**: Tests that
are based on modifying the value of `ignore_time` tag in `ossec.conf`, setting different times and checking the
result in `ossec.log`.

- **[test_general_settings_interval](./doc/test_general_settings/test_general_settings_interval.md)**: Tests that
are based on modifying the value of `interval` tag in `ossec.conf`, setting different times and checking the
result in `ossec.log`.

- **[test_general_settings_run_on_start](./doc/test_general_settings/test_general_settings_run_on_start.md)**: Tests
that are based on modifying the value of `run_on_start` tag in `ossec.conf` and checking the result in `ossec.log`.

#### Test scan results

- **[test_debian_inventory_debian_feed](./doc/test_scan_results/test_debian_inventory_debian_feed.md)**: Tests that
are based on mocking debian systems and inserting custom vulnerabilities and vulnerable packages to see if vulnerability
detector generates the vulnerability alerts from Debian provider feed.

- **[test_redhat_inventory_redhat_feed](./doc/test_scan_results/test_redhat_inventory_redhat_feed.md)**: Tests that are
based on mocking redhat systems and inserting custom vulnerabilities and vulnerable packages to see if vulnerability
detector generates the vulnerability alerts from Red Hat provider feed.

- **[test_ubuntu_inventory_canonical_feed](./doc/test_scan_results/test_ubuntu_inventory_canonical_feed.md)**: Tests
that are based on mocking ubuntu systems and inserting custom vulnerabilities and vulnerable packages to see if
vulnerability detector generates the vulnerability alerts from Canonical provider feed.

- **[test_scan_nvd_feed](./doc/test_scan_results/test_scan_nvd_feed.md)**: Tests that are based on mocking Red Hat,
Canonical, Debian and Windows systems, and inserting custom vulnerabilities and vulnerable packages to see if
vulnerability detector generates the vulnerability alerts from NVD feed.

- **[test_scan_providers_and_nvd_feed](./doc/test_scan_results/test_scan_providers_and_nvd_feed.md)**: Tests that are
based on mocking Red Hat, Canonical and Debian systems, and inserting custom vulnerabilities and vulnerable packages to
see if vulnerability detector generates the vulnerability alerts from NVD and providers feed.

---

### Tier 1

#### Test feeds

- **[test_download_feeds](./doc/test_feeds/generic/test_download_feeds.md)**: Tests that are based on downloading the
different feeds (redhat, canonical, debian and NVD) and looking for the message confirming that the feeds have been
downloaded and imported correctly.

#### Test providers

- **[test_providers_enabled](./doc/test_providers/test_providers_enabled.md)**: Tests that are based on modifying the
value of `enabled` tag in `ossec.conf` and checking the result in `ossec.log`.

- **[test_providers_os](./doc/test_providers/test_providers_os.md)**: Tests that are based on modifying the value
of `os` tag in `ossec.conf`, setting different os for Canonical and Debian and checking the result in `ossec.log`.

- **[test_providers_update_from_year](./doc/test_providers/test_providers_update_from_year.md)**: Tests that are based
on modifying the value of `update_from_year` tag in `ossec.conf`, setting different years and checking the result in
`ossec.log`.

- **[test_providers_update_interval](./doc/test_providers/test_providers_update_interval.md)**: Tests that are based
on modifying the value of `interval` tag in `ossec.conf`, setting different time intervals and units, and checking the
result in `ossec.log`.

---

### Tier 2

#### Test feeds - GENERIC

- **[test_invalid_type_custom_feeds](./doc/test_feeds/generic/test_invalid_type_custom_feeds.md)**: Tests that are
based on importing files of several different types (`.mp3`, `.jpg`, `.pdf` ...) as custom feed, and observing the
response of vulnerability detector.

- **[test_validate_feed_content](./doc/test_feeds/generic/test_validate_feed_content.md)**: Tests that are based on
downloading the feeds of all providers and verifying that the format of each feed is as expected and that the
content of the feed is also `XML` or `JSON` parseable.

#### Test feeds - RHEL

- **[test_extra_fields_redhat_feed](./doc/test_feeds/redhat/test_extra_fields_redhat_feed.md)**: Set of tests that are
based on checking the behavior of vulnerability detector when there is any extra field in the feed.

- **[test_invalid_syntax_redhat_feed](./doc/test_feeds/redhat/test_invalid_syntax_redhat_feed.md)**: Set of tests that
are based on checking the behavior of vulnerability detector when the feed has some kind of syntactic error: it doesn't
have a closing field, it's missing some character ...

- **[test_invalid_values_redhat_feed](./doc/test_feeds/redhat/test_invalid_values_redhat_feed.md)**: Set of tests that
are based on checking the behavior of vulnerability detector when the value of a field is not correct: invalid type,
strange characters ...

- **[test_missing_fields_redhat_feed](./doc/test_feeds/redhat/test_missing_fields_redhat_feed.md)**: Set of tests that
are based on checking the behavior of vulnerability detector when any field is missing from the feed.

#### Test feeds - CANONICAL

- **[test_extra_tags_canonical_feed](./doc/test_feeds/canonical/test_extra_tags_canonical_feed.md)**:  Set of tests
that are based on checking the behavior of vulnerability detector when there is any extra tag in the feed.

- **[test_invalid_syntax_canonical_feed](./doc/test_feeds/canonical/test_invalid_syntax_canonical_feed.md)**: Set of
tests that are based on checking the behavior of vulnerability detector when the feed has some kind of syntactic error:
it doesn't have a closing tag, it's missing some character ...

- **[test_invalid_values_canonical_feed](./doc/test_feeds/canonical/test_invalid_values_canonical_feed.md)**: Set of
tests that are based on checking the behavior of vulnerability detector when the value of a tag is not correct:
invalid type, strange characters ...

- **[test_missing_tags_canonical_feed](./doc/test_feeds/canonical/test_missing_tags_canonical_feed.md)**: Set of tests
that are based on checking the behavior of vulnerability detector when any tag is missing from the feed.

#### Test feeds - DEBIAN

- **[test_extra_tags_debian_feed](./doc/test_feeds/debian/test_extra_tags_debian_feed.md)**: Set of tests that are
based on checking the behavior of vulnerability detector when there is any extra tag in the feed.

- **[test_invalid_syntax_debian_feed](./doc/test_feeds/debian/test_invalid_syntax_debian_feed.md)**: Set of tests that
are based on checking the behavior of vulnerability detector when the feed has some kind of syntactic error: it doesn't
have a closing tag, it's missing some character ...

- **[test_invalid_values_debian_feed](./doc/test_feeds/debian/test_invalid_values_debian_feed.md)**: Set of tests that
are based on checking the behavior of vulnerability detector when the value of a tag is not correct: invalid type,
strange characters ...

- **[test_missing_tags_debian_feed](./doc/test_feeds/debian/test_missing_tags_debian_feed.md)**: Set of tests that are
based on checking the behavior of vulnerability detector when any tag is missing from the feed.
