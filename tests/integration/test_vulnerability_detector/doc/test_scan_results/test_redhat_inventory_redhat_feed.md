# Test Ubuntu inventory Canonical feed

Tests that are based on mocking Red Hat systems and inserting custom vulnerabilities and vulnerable packages to see if
vulnerability detector generates the vulnerability alerts from Red Hat provider feed.

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 0 | 4 | 0:01:18 | [test_redhat_inventory_redhat_feed.py](../../test_scan_results/test_redhat_inventory_redhat_feed.py)|

## Test logic

For each of the following Red Hat systems:

```
RHEL8, RHEL7, RHEL6, RHEL5
```

the following is done:

- Clean NVD, `vulnerabilities` and `sys_programs tables`.
- Mock system.
- Insert [Red Hat custom feed and vulnerable packages](../../test_scan_results/data/redhat_vulnerabilities.json).
- Import NVD vulnerabilities from [custom NVD feed](../../test_scan_results/data/real_nvd_feed.json).
- Check the following event in `ossec.log`:
  ```
  The '{package}' package .* from agent .* is vulnerable to '{cve}'
  ```

## Checks

- [x] A report of the corresponding vulnerabilities is generated in the `ossec.log`.

## Observed behaviour

The expected behavior is carried out.

## Execution result

```
========================================= test session starts ==========================================
platform linux -- Python 3.7.3, pytest-5.4.2, py-1.8.1, pluggy-0.13.1
rootdir: /root/wazuh-qa/tests/integration, inifile: pytest.ini
plugins: html-2.0.1, metadata-1.9.0, testinfra-5.0.0
collected 4 items

test_vulnerability_detector/test_scan_results/test_redhat_inventory_redhat_feed.py ....          [100%]

===================================== 4 passed in 78.14s (0:01:18) =====================================
```
