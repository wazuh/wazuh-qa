# Test missing tags Debian feed

Set of tests that are based on checking the behavior of vulnerability detector when any tag is missing from the feed.

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 2 | 38  | 0:07:10 | [test_missing_tags_debian_feed.py](../../../test_feeds/debian/test_missing_tags_debian_feed.py)|

## Test logic

Each test consists of removing one of the following tags from the feed:

```
['no_changes', 'generator', 'product_name', 'schema_version', 'timestamp',
 'definitions', 'definition', 'metadata', 'title', 'description', 'affected',
 'platform', 'product', 'reference', 'debian', 'date', 'criteria', 'criterion',
 'tests', 'textfilecontent54_test', 'test_object_ref', 'test_state_ref',
 'uname_test', 'test_uname_object_ref', 'dpkginfo_test', 'objects',
 'textfilecontent54_object', 'path', 'filename', 'instance', 'uname_object',
 'dpkginfo_object', 'states', 'textfilecontent54_state', 'subexpression',
 'dpkginfo_state', 'evr']
```

## Tests

- `test_no_feed_changes`: Check that the feed is imported successfully with the original feed.
- `test_missing_tags_debian_feed`: The tests are based on removing a certain tag from feed.

## Checks

- [x] Feed is imported successfully with the original feed.
- [x] Vulnerabilities are inserted into the `vulnerabilities` database.
- [x] Action status message displayed in `ossec.log`.
- [x] `Modulesd` is running after the test (don't crash).

## Observed behaviour

The feed will not be imported if:

- There is a key tag missing:

  ```
  key_tags = ['definitions', 'definition', 'metadata', 'reference', 'criteria']
  ```

**Xfailing** (https://github.com/wazuh/wazuh/issues/5322) if there is one of the following tags missing:

```
xfail_list = ['definitions', 'metadata', 'reference', 'criteria']
```

For other cases, the feed will be imported successfully.

## Execution result

```
========================================= test session starts ==========================================
platform linux -- Python 3.7.3, pytest-5.4.2, py-1.8.1, pluggy-0.13.1
rootdir: /root/wazuh-qa/tests/integration, inifile: pytest.ini
plugins: html-2.0.1, metadata-1.9.0, testinfra-5.0.0
collected 38 items

test_vulnerability_detector/test_feeds/debian/test_missing_tags_debian_feed.py ......x.x.....x.. [ 44%]
x....................                                                                            [100%]

============================== 34 passed, 4 xfailed in 430.93s (0:07:10) ===============================
```
