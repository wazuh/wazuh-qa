# Test missing fields Red Hat feed

Set of tests that are based on checking the behavior of vulnerability detector when any field is missing from the feed.

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 2 | 14 | 0:02:12 | [test_missing_fields_redhat_feed.py](../../../test_feeds/redhat/test_missing_fields_redhat_feed.py)|

## Test logic

Each test consists of removing one of the following fields from the feed:

```
['CVE', 'severity', 'public_date', 'advisories', 'bugzilla',
 'bugzilla_description', 'cvss_score', 'cvss_scoring_vector',
 'CWE', 'affected_packages', 'resource_url', 'cvss3_scoring_vector',
 'cvss3_score']
```

## Tests

- `test_no_feed_changes`: Check that the feed is imported successfully with the original feed.
- `test_missing_fields_redhat_feed`: The tests are based on removing a certain field from feed.

## Checks

- [x] Feed is imported successfully with the original feed.
- [x] Vulnerabilities are inserted into the `vulnerabilities` database.
- [x] Action status message displayed in `ossec.log`.
- [x] `Modulesd` is running after the test (don't crash).

## Observed behaviour

The feed will not be imported if:

- There is a key field missing:

  ```
  key_fields = ['CVE', 'bugzilla_description', 'affected_packages']
  ```

**Xfailing** (https://github.com/wazuh/wazuh/issues/5272) if

> Vulnerabilities are not imported even though the opposite is logged in ossec.log

For other cases, the feed will be imported successfully.

## Execution result

```
========================================== test session starts ==========================================
platform linux -- Python 3.6.8, pytest-5.4.1, py-1.8.1, pluggy-0.13.1
rootdir: /root/wazuh-qa/tests/integration, inifile: pytest.ini
plugins: metadata-1.8.0, html-2.0.1, testinfra-5.0.0
collected 14 items

test_vulnerability_detector/test_feeds/redhat/test_missing_fields_redhat_feed.py ..........x...   [100%]

=============================== 13 passed, 1 xfailed in 132.81s (0:02:12) ===============================
```
