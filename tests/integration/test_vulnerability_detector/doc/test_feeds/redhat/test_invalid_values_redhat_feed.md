# Test invalid values Red Hat feed

Set of tests to check the behavior of Vulnerability Detector when the value of a tag is not correct: invalid type, strange characters...

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 2 | 131 | 0::21:26 | [test_invalid_values_redhat_feed.py](../../../test_feeds/redhat/test_invalid_values_redhat_feed.py)|

## Test logic

For each of the following fields

```
[CVE, severity, public_date, advisories, bugzilla, bugzilla_description,
 cvss_score, cvss_scoring_vector, CWE, affected_packages, resource_url,
cvss3_scoring_vector, cvss3_score]
```

is assigned the following values:

```
[None, "", "dummy value", 12345, ['1', '2', '3', '4', '5'], "ñ", "テスト",
 "ИСПЫТАНИЕ", "测试", "اختبار"]
```

For instance:

```
"CVE": None
```

## Tests

- `test_no_feed_changes`: Check the original feed is successfully imported.
- `test_invalid_values_redhat_feed`: The tests are based on modifying the feed assigning strange values.

## Checks

- [x] The original feed is successfully imported.
- [x] Vulnerabilities are inserted into the `vulnerabilities` database.
- [x] Action status message displayed in `ossec.log`.
- [x] `wazuh-modulesd` is still running once the test has finished (it didn't crash).

## Observed behaviour

The feed will not be imported if:

- A key field has not the expected type. These are the key fields:

  ```
   key_fields = ['CVE', 'bugzilla_description', 'affected_packages']
  ``

**Xfailing** (https://github.com/wazuh/wazuh/issues/5272) if:

- `affected_packages` is modified. Vulnerabilities has not imported but the opposite is shown in `ossec.log`

For other cases, the feed will be imported successfully.

## Execution result

```
========================================== test session starts ==========================================
platform linux -- Python 3.6.8, pytest-5.4.1, py-1.8.1, pluggy-0.13.1
rootdir: /root/wazuh-qa/tests/integration, inifile: pytest.ini
plugins: metadata-1.8.0, html-2.0.1, testinfra-5.0.0
collected 131 items

test_vulnerability_detector/test_feeds/redhat/test_invalid_values_redhat_feed.py ................ [ 12%]
...........................................................................xxxxxxxxxx............ [ 86%]
..................                                                                                [100%]

============================= 121 passed, 10 xfailed in 1286.03s (0:21:26) ==============================
```
