-
  name: "force_options_enabled"
  description: "Check that an agent can be replaced when force is enabled"
  configuration:
    - force:
      elements:
      - enabled:
          value: 'yes'
      - key_mismatch:
          value: 'no'
      - disconnected_time:
          attributes:
          - enabled: 'no'
          value: 0
      - after_registration_time:
          value: 0
  pre_existent_agents:
    -
      id: '001'
      name: agent_dup_name
    -
      id: '002'
      name: agent_dup_ip
      ip: '2.2.2.2'
  test_case:
  -
    description: Insert an agent with duplicated name
    input:
      name: 'agent_dup_name'
    output:
      status: 'success'
    log:
      - Duplicate name. Removing old agent 'agent_dup_name' (id '001').
  -
    description: Insert an agent with duplicated ip
    input:
      name: 'agent_dup_ip_new'
      ip: '2.2.2.2'
    output:
      status: 'success'
    log:
      - Duplicate IP '2.2.2.2'. Removing old agent 'agent_dup_ip' (id '002').
-
  name: "force_options_disabled"
  description: "Check that an agent can´t be replaced when force is disabled"
  configuration:
    enabled: 'no'
    key_mismatch: 'no'
    disconnected_time:
      value: 0
      attributes:
      - enabled: 'no'
    after_registration_time: 0
  pre_existent_agents:
    -
      id: '001'
      name: agent_dup_name
    -
      id: '002'
      name: agent_dup_ip
      ip: '2.2.2.2'
  test_case:
  -
    description: Try to replace an agent with duplicated name
    input:
      name: 'agent_dup_name'
    output:
      status: 'error'
    log:
      - Duplicate name 'agent_dup_name', rejecting enrollment. Agent '001' won't be removed because the force option is disabled.
  -
    description: Try to replace an agent with duplicated ip
    input:
      name: 'agent_dup_name_new'
      ip: '2.2.2.2'
    output:
      status: 'error'
    log:
      - Duplicate IP '2.2.2.2', rejecting enrollment. Agent '002' won't be removed because the force option is disabled.
-
  name: "force_insert_disabled"
  description: "Check that legacy force_insert overrides force.enabled"
  configuration:
    enabled: 'yes'
    key_mismatch: 'no'
    disconnected_time:
      value: 0
      attributes:
      - enabled: 'no'
    after_registration_time: 0
    force_insert : 'no'
  pre_existent_agents:
    -
      id: '001'
      name: agent_1
  log:
    - The <force_insert> tag is deprecated since version 4.3.0.
    - Setting <force><enabled> tag to 'no' to comply with the legacy <force_insert> option found.
  test_case:
  -
    description: Don´t replace an agent if force_insert disabled force options
    input:
      name: 'agent_1'
    output:
      status: 'error'
    log:
      - Duplicate name 'agent_1', rejecting enrollment. Agent '001' won't be removed because the force option is disabled.
-
  name: "force_insert_enabled"
  description: "Check that legacy force_insert overrides force.enabled"
  configuration:
    enabled: 'no'
    key_mismatch: 'no'
    disconnected_time:
      value: 0
      attributes:
      - enabled: 'no'
    after_registration_time: 0
    force_insert : 'yes'
  pre_existent_agents:
    -
      name: agent_1
      id: '001'
  log:
    - The <force_insert> tag is deprecated since version 4.3.0.
    - Setting <force><enabled> tag to 'yes' to comply with the legacy <force_insert> option found.
  test_case:
  -
    description: Replace an agent if force_insert enabled force options
    input:
      name: 'agent_1'
    output:
      status: 'success'
    log:
      - Duplicate name. Removing old agent 'agent_1' (id '001')