---
- #ADD
  name: 'AddAgent default'
  description: 'Add an agent with name and IP'
  pre_existent_keys:
  test_case:
  -
    input: '{"arguments":{"name":"user1","ip":"any"},"function":"add"}'
    output: '{"error":0,"data":{"id":"001","name":"user1","ip":"any","key":'
  -
    input: '{"arguments":{"name":"user2","ip":"any"},"function":"add"}'
    output: '{"error":0,"data":{"id":"002","name":"user2","ip":"any","key":'
  -
    input: '{"arguments":{"name":"user3","ip":"192.0.0.0"},"function":"add"}'
    output: '{"error":0,"data":{"id":"003","name":"user3","ip":"192.0.0.0","key":'
-
  name: 'AddAgent ID'
  description: 'Add an agent with specific ID'
  pre_existent_keys:
  test_case:
  -
    input: '{"arguments":{"id":"100","name":"user100","ip":"any"},"function":"add"}'
    output: '{"error":0,"data":{"id":"100","name":"user100","ip":"any","key":'
-
  name: 'AddAgent KEY'
  description: 'Add an agent with specific Key'
  pre_existent_keys:
    - '100 user100 any SecretKey'
  test_case:
  -
    input: '{"arguments":{"name":"user4","ip":"any","key":"675aaf366e6827ee7a77b2f7b4d89e603a21333c09afbb02c40191f199d7c915"},"function":"add"}'
    output: '{"error":0,"data":{"id":"101","name":"user4","ip":"any","key":"675aaf366e6827ee7a77b2f7b4d89e603a21333c09afbb02c40191f199d7c915"'
-
  name: 'ERROR Duplicate Name'
  description: 'Try to add an agent with an existent name'
  pre_existent_keys:
    - '001 user1 any SecretKey'
  test_case:
  -
    input: '{"arguments":{"name":"user1","ip":"any"},"function":"add"}'
    output: '{"error":9008,"message":"Duplicate name"}'
-
  name: 'ERROR Duplicate IP'
  description: 'Try to add an agent with an existent IP'
  pre_existent_keys:
    - '001 user1 192.0.0.0 SecretKey'
  test_case:
  -
    input: '{"arguments":{"name":"user_","ip":"192.0.0.0"},"function":"add"}'
    output: '{"error":9007,"message":"Duplicate IP"}'
-
  name: 'ERROR Duplicate ID'
  description: 'Try to add an agent with an existent ID'
  pre_existent_keys:
    - '001 user1 any SecretKey'
  test_case:
  -
    input: '{"arguments":{"id":"001","name":"user_","ip":"any"},"function":"add"}'
    output: '{"error":9012,"message":"Duplicate ID"}'
-
  name: 'Force'
  description: 'Add duplicate agents with force option'
  pre_existent_keys:
    - '001 user1 any SecretKey'
    - '002 user2 192.0.0.0 SecretKey'
    - '003 user3 any SecretKey'
  test_case:
  -
    input: '{"arguments":{"force":1,"name":"user1","ip":"any"},"function":"add"}'
    output: '{"error":0,"data":{"id":"004","name":"user1","ip":"any","key":'
  -
    input: '{"arguments":{"force":1,"name":"user_2","ip":"192.0.0.0"},"function":"add"}'
    output: '{"error":0,"data":{"id":"005","name":"user_2","ip":"192.0.0.0","key":'
  -
    input: '{"arguments":{"force":1,"id":"003","name":"user_3","ip":"any"},"function":"add"}'
    output: '{"error":0,"data":{"id":"003","name":"user_3","ip":"any","key":'
-
  name: 'Single Group'
  description: 'Try to add an agent with group'
  pre_existent_keys:
  groups:
    - 'Group1'
  test_case:
  -
    input: '{"arguments":{"name":"user21","ip":"any","groups":"Group1"},"function":"add"}'
    output: '{"error":0,"data":{"id":"001","name":"user21","ip":"any","key":'
  -
    input: '{"arguments":{"name":"user_","ip":"any","groups":"Group2"},"function":"add"}'
    output: '{"error":9014,"message":"Invalid Group(s) Name(s)"}'
-
  name: 'Multi Group'
  description: 'Try to add an agent with multiple group'
  pre_existent_keys:
  groups:
    - 'Group1'
    - 'Group2'
  test_case:
  -
    input: '{"arguments":{"name":"user22","ip":"any","groups":"Group1,Group2"},"function":"add"}'
    output: '{"error":0,"data":{"id":"001","name":"user22","ip":"any","key":'
  -
    input: '{"arguments":{"name":"user_","ip":"any","groups":"Group1,Group2,Group3"},"function":"add"}'
    output: '{"error":9014,"message":"Invalid Group(s) Name(s)"}'

- #REMOVE
  name: 'Remove agent'
  description: 'Remove an agent default (no save_removed, no purge)'
  pre_existent_keys:
    - '001 user1 any SecretKey'
    - '002 user1 any SecretKey'
    - '003 user1 any SecretKey'
  test_case:
  -
    input: '{"arguments":{"id":"001"},"function":"remove"}'
    output: '{"error":0,"data":"Agent deleted successfully."}'
  -
    input: '{"arguments":{"id":"002", "purge":true},"function":"remove"}'
    output: '{"error":0,"data":"Agent deleted successfully."}'
  -
    input: '{"arguments":{"id":"200"},"function":"remove"}'
    output: '{"error":9011,"message":"Agent ID not found"}'

- # Add agent with key_hash
  name: 'Agent with key hash 1'
  description: 'Simple request with key hash for new user'
  pre_existent_keys:
  test_case:
  -
    input: '{"arguments":{"name":"new_user1","ip":"any","key_hash":"123ABC"},"function":"add"}'
    output: '{"error":0,"data":{"id":"001","name":"new_user1","ip":"any","key":'
-
  name: 'Agent with key hash 2'
  description: 'Simple request with wrong key hash for existing user'
  pre_existent_keys:
    - '001 user1 any 998bb619f50225fa0a4ec3b2a4888ae0a9b1d249189827462a5689d1d5586deb'
  test_case:
  -
    input: '{"arguments":{"force":1,"name":"user1","ip":"any","key_hash":"123ABC"},"function":"add"}'
    output: '{"error":0,"data":{"id":"002","name":"user1","ip":"any","key":'
-
  name: 'Agent with key hash 3'
  description: 'Simple request with right key hash for existing user'
  pre_existent_keys:
    - '001 user1 any 998bb619f50225fa0a4ec3b2a4888ae0a9b1d249189827462a5689d1d5586deb'
  test_case:
  # The output message isn't giving details about the same key, it still uses the 'Duplicated name' message
  -
    input: '{"arguments":{"force":1,"name":"user1","ip":"any","key_hash":"74ccacd341a6087b2d3a31656b07664a9c5bb307"},"function":"add"}'
    output: '{"error":9008,"message":"Duplicated name"}'
-
  name: 'Agent with key hash 4'
  description: 'Complete request with key hash for new user'
  pre_existent_keys:
  groups:
    - 'Group1'
  test_case:
  -
    input: '{"arguments":{"force":1,"name":"user1","ip":"10.10.10.10","groups":"Group1","key_hash":"123ABC"},"function":"add"}'
    output: '{"error":0,"data":{"id":"001","name":"user1","ip":"10.10.10.10","key":'
-
  name: 'Agent with key hash 5'
  description: 'Complete request with wrong key hash for existing user'
  pre_existent_keys:
    - '001 user1 any 998bb619f50225fa0a4ec3b2a4888ae0a9b1d249189827462a5689d1d5586deb'
  groups:
    - 'Group1'
  test_case:
  -
    input: '{"arguments":{"force":1,"name":"user1","ip":"10.10.10.10","groups":"Group1","key_hash":"123ABC"},"function":"add"}'
    output: '{"error":0,"data":{"id":"002","name":"user1","ip":"10.10.10.10","key":'
-
  name: 'Agent with key hash 6'
  description: 'Complete request with right key hash for existing user'
  pre_existent_keys:
    - '001 user1 any 998bb619f50225fa0a4ec3b2a4888ae0a9b1d249189827462a5689d1d5586deb'
  groups:
    - 'Group1'
  test_case:
  -
    input: '{"arguments":{"force":1,"name":"user1","ip":"10.10.10.10","groups":"Group1","key_hash":"74ccacd341a6087b2d3a31656b07664a9c5bb307"},"function":"add"}'
    output: '{"error":9008,"message":"Duplicated name"}'
-
  name: 'Agent with key hash 7'
  description: 'Complete request with right key hash for existing IP'
  pre_existent_keys:
    - '001 user1 10.10.10.10 998bb619f50225fa0a4ec3b2a4888ae0a9b1d249189827462a5689d1d5586deb'
  groups:
    - 'Group1'
  test_case:
  -
    input: '{"arguments":{"force":1,"name":"user_","ip":"10.10.10.10","groups":"Group1","key_hash":"74ccacd341a6087b2d3a31656b07664a9c5bb307"},"function":"add"}'
    output: '{"error":9007,"message":"Duplicated IP"}'
