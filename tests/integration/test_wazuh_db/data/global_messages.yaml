---
-
  name: "Basics success"
  description: "Check success use cases for each global command"
  test_case:
  -
    input: 'global delete-group TestGroup1'
    output: "ok"
    stage: "global delete-group previous insert"
  -
    input: 'global find-group TestGroup1'
    output: "ok []"
    stage: "global find-group previous insert"    
  -
    input: 'global insert-agent-group TestGroup1'
    output: 'ok'
    stage: "global insert-agent-group success"
  -
    input: 'global find-group default'
    output: 'ok [{"id":1}]'
    stage: "global find-group after insert"
  -
    input: 'global find-group TestGroup1'
    output: 'ok [{"id":2}]'
    stage: "global find-group after insert" 
  -
    input: 'global select-groups'
    output: 'ok [{"name":"default"},{"name":"TestGroup1"}]'
    stage: "global select-groups success"
  -  
    input: 'global delete-agent 1'
    output: "ok"
    stage: "global delete-agent previous insert"
  -
    input: 'global get-agent-info 1'
    output: 'ok []'
    stage: "global get-agent-info previous insert"
  -
    input: 'global insert-agent {"id":1,"name":"TestName1","ip":"0.0.0.1","register_ip":"0.0.0.1","internal_key":"TopSecret","group":"TestGroup1","date_add":1599223378}'
    output: "ok"
    stage: "global insert-agent success"
  -
    input: 'global get-agent-info 1'
    output: 'ok [{"id":1,"name":"TestName1","ip":"0.0.0.1","register_ip":"0.0.0.1","internal_key":"TopSecret","node_name":"unknown","date_add":1599223378,"status":"empty","fim_offset":0,"reg_offset":0,"group":"TestGroup1","sync_status":1}]'
    stage: "global get-agent-info after insert"
  -
    input: 'global find-agent {"name":"TestName1","ip":"0.0.0.1"}'
    output: 'ok [{"id":1}]'
    stage: "global find-agent success"
  -
    input: 'global update-agent-name {"id":1,"name":"TestName2"}'
    output: "ok"
    stage: "global update-agent-name success"
  -
    input: 'global update-agent-version {"id":1,"os_name":"TestOsName","os_version":"TestOsVersion","os_major":"TestOsMajor","os_minor":"TestOsMinor","os_codename":"TestOsCodeName","os_platform":"TestOsPlatfor","os_build":"TestOsBuild","os_uname":"TestOsUname","os_arch":"TestOsArch","version":"TestOsVersion","config_sum":"TestConfigSum","merged_sum":"TestMergedSum","manager_host":"TestManagerHost","node_name":"TestNodeName","agent_ip":"0.0.0.1","sync_status":1}'
    output: "ok"
    stage: "global update-agent-version success"
  -
    input: 'global update-agent-status {"id":1,"status":"updated"}'
    output: "ok"
    stage: "global update-agent-status success"
  -
    input: 'global update-agent-group {"id":1,"group":"TestGroup2"}'
    output: "ok"
    stage: "global update-agent-group success"
  -
    input: 'global update-fim-offset {"id":1,"offset":100}'
    output: "ok"
    stage: "global update-fim-offset success"
  -
    input: 'global update-reg-offset {"id":1,"offset":100}'
    output: "ok"
    stage: "global update-reg-offset success"
  -
    input: 'global update-keepalive {"id":1,"sync_status":1}'
    output: "ok"
    stage: "global update-keepalive success"
  -
    input: 'global get-agent-info 1'
    output: 'ok [{"id":1,"name":"TestName1","ip":"0.0.0.1","register_ip":"0.0.0.1","internal_key":"TopSecret","os_name":"TestOsName","os_version":"TestOsVersion","os_major":"TestOsMajor","os_minor":"TestOsMinor","os_codename":"TestOsCodeName","os_build":"TestOsBuild","os_platform":"TestOsPlatfor","os_uname":"TestOsUname","os_arch":"TestOsArch","version":"TestOsVersion","config_sum":"TestConfigSum","merged_sum":"TestMergedSum","manager_host":"TestManagerHost","node_name":"TestNodeName","date_add":1599223378,"status":"updated","fim_offset":100,"reg_offset":100,"group":"TestGroup","sync_status":1}]'
    stage: "global get-agent-info success after updates"
  -
    input: 'global set-labels 1 TestKey:TestLabel'
    output: 'ok'
    stage: "global get-agent-info success after updates"
  -
    input: 'global get-labels 1'
    output: 'ok [{"id":1,"key":"#\"_agent_ip\"","value":"0.0.0.1"},{"id":1,"key":"#\"_manager_hostname\"","value":"TestManagerHost"},{"id":1,"key":"#\"_node_name\"","value":"TestNodeName"},{"id":1,"key":"TestKey","value":"TestLabel"}]'
    stage: "global get-agent-info success after updates"
  -
    input: 'global select-agent-name 1'
    output: 'ok [{"name":"TestName2"}]'
    stage: "global select-agent-name success"
  -
    input: 'global select-agent-group  1'
    output: 'ok [{"group":"TestGroup2"}]'
    stage: "global select-agent-group success"
  -
    input: 'global select-agent-status 1'
    output: 'ok [{"status":"updated"}]'
    stage: "global select-agent-status success"
  -
    input: 'global select-fim-offset 1'
    output: 'ok [{"fim_offset":100}]'
    stage: "global select-fim-offset success"
  -
    input: 'global select-reg-offset 1'
    output: 'ok [{"reg_offset":100}]'
    stage: "global select-reg-offset success"
  -
    input: 'global select-keepalive TestName1 0.0.0.1'
    output: 'ok [{"last_keepalive":*}]'
    stage: "global select-keepalive success"
    use_regex: "yes" 
  -
    input: 'global select-groups'
    output: 'ok [{"name":"default"},{"name":"TestGroup1"}]'
    stage: "global select-groups success"

  -
    input: 'global get-all-agents start_id -1'
    output: 'ok 0,1'
    stage: "global get-all-agents success"
  -
    input: 'global get-agents-by-keepalive condition > 100 start_id 0'
    output: 'ok 1'
    stage: "global get-agents-by-keepalive success"
  -
    input: 'global get-agents-by-keepalive condition < 100 start_id 0'
    output: 'ok '
    stage: "global get-agents-by-keepalive success"

  -
    input: 'global sync-agent-info-get start_id 0'
    output: 'ok [{"id":1,"name":"TestName1","ip":"0.0.0.1","os_name":"TestOsName","os_version":"TestOsVersion","os_major":"TestOsMajor","os_minor":"TestOsMinor","os_codename":"TestOsCodeName","os_build":"TestOsBuild","os_platform":"TestOsPlatfor","os_uname":"TestOsUname","os_arch":"TestOsArch","config_sum":"TestOsVersion","merged_sum":"TestMergedSum","manager_host":"TestManagerHost","node_name":"TestNodeName","last_keepalive":*,"labels":[{"id":1,"key":"#\\"_agent_ip\\"","value":"0.0.0.1"},{"id":1,"key":"#\\"_manager_hostname\\"","value":"TestManagerHost"},{"id":1,"key":"#\\"_node_name\\"","value":"TestNodeName"},{"id":1,"key":"TestKey","value":"TestLabel"}]}]'
    stage: "global sync-agent-info-get"
    use_regex: 'yes'
  -
    input: 'global sync-agent-info-get'
    output: 'ok [{"id":1,"name":"TestName1","ip":"0.0.0.1","os_name":"TestOsName","os_version":"TestOsVersion","os_major":"TestOsMajor","os_minor":"TestOsMinor","os_codename":"TestOsCodeName","os_build":"TestOsBuild","os_platform":"TestOsPlatfor","os_uname":"TestOsUname","os_arch":"TestOsArch","config_sum":"TestOsVersion","merged_sum":"TestMergedSum","manager_host":"TestManagerHost","node_name":"TestNodeName","last_keepalive":*,"labels":[{"id":1,"key":"#\\"_agent_ip\\"","value":"0.0.0.1"},{"id":1,"key":"#\\"_manager_hostname\\"","value":"TestManagerHost"},{"id":1,"key":"#\\"_node_name\\"","value":"TestNodeName"},{"id":1,"key":"TestKey","value":"TestLabel"}]}]'
    stage: "global sync-agent-info-get"
    use_regex: 'yes'
  -
    input: 'global sync-agent-info-set'
    output: 'ok'
    stage: "global sync-agent-info-set"
    

  -
    input: 'global insert-agent-belong {"id_group":1,"id_agent":1}'
    output: 'ok'
    stage: "global insert-agent-belong success"
  -
    input: 'global delete-agent-belong 1'
    output: 'ok'
    stage: "global delete-agent-belong success"
  -
    input: 'global insert-agent-belong {"id_group":1,"id_agent":1}'
    output: 'ok'
    stage: "global insert-agent-belong success"
  -
    input: 'global delete-group-belong TestGroup1'
    output: 'ok'
    stage: "global delete-group-belong"
  -
    input: 'global delete-group TestGroup1'
    output: "ok"
    stage: "global delete-group after insert"   
  -
    input: 'global delete-agent 1'
    output: "ok"
    stage: "global delete-agent after insert"
