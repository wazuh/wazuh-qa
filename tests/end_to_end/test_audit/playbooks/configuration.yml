---
- name: Test case configuration
  hosts: wazuh-manager
  tasks:
    - name: Get euid
      shell: echo $EUID
      register: euid
    - debug:
            var: euid.stdout
    - name: Create wazuh audit rules file
      become: True
      copy:
        dest: /etc/audit/rules.d/wazuh.rules
        content: |
          -a exit,always -F euid={{euid.stdout}} -F arch=b32 -S execve -k audit-wazuh-c
          -a exit,always -F euid={{euid.stdout}} -F arch=b64 -S execve -k audit-wazuh-c
    - name: Delete previous audit rules
      become: True
      shell: auditctl -D
    - name: Load audit rules
      become: True
      shell: auditctl -R /etc/audit/rules.d/wazuh.rules
