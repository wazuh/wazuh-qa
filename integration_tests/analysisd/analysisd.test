#!/usr/bin/env python
import os, datetime, time, sys
from feeder import feeding

#Getting install directory
def getOssecConfig(initconf,path):
    if os.path.isfile(path):
        with open(path) as f:
            for line in f.readlines():
                key, value = line.rstrip("\n").split("=")
                initconf[key] = value.replace("\"","")
        if initconf["NAME"] != "Wazuh" or not os.path.exists(initconf["DIRECTORY"]):
            print "Seems like there is no correct Wazuh installation "
            sys.exit(1)
    else:
        print "Seems like there is no Wazuh installation or ossec-init.conf is missing."
        sys.exit(1)

def rootcheckTest(basedir):
    title = "Analysisd Rootcheck decoder can handle spurious data"

    try:
        feeding(basedir,'9:/var/:')
        time.sleep(1)
        feeding(basedir,'9:/var/:')
    except BaseException as e:
        print("not ok - {0}".format(title))
        sys.exit(1)
    print("ok - {0}".format(title))

if __name__ == "__main__":
    ossec_init = {}
    initconfigpath = "/etc/ossec-init.conf"
    getOssecConfig(ossec_init, initconfigpath)
    rootcheckTest(ossec_init["DIRECTORY"])
