[36m[2024-05-20 18:14:30] [DEBUG] [486264] [MainThread] [workflow_engine]: Validating input file: modules/workflow_engine/examples/agent/aws/test-agent-basic-info.yaml[0m
[36m[2024-05-20 18:14:30] [DEBUG] [486264] [MainThread] [workflow_engine]: Loading schema file: /home/fcaffieri/repos/wazuh-qa/.venv/lib/python3.10/site-packages/workflow_engine/schemas/schema_v1.json[0m
[36m[2024-05-20 18:14:30] [DEBUG] [486264] [MainThread] [workflow_engine]: Loading yaml file: modules/workflow_engine/examples/agent/aws/test-agent-basic-info.yaml[0m
[36m[2024-05-20 18:14:31] [DEBUG] [486264] [MainThread] [workflow_engine]: Loading workflow file: modules/workflow_engine/examples/agent/aws/test-agent-basic-info.yaml[0m
[36m[2024-05-20 18:14:31] [DEBUG] [486264] [MainThread] [workflow_engine]: Process workflow.[0m
[32m[2024-05-20 18:14:31] [INFO] [486264] [MainThread] [workflow_engine]: Executing DAG tasks.[0m
[32m[2024-05-20 18:14:31] [INFO] [486264] [MainThread] [workflow_engine]: Executing tasks in parallel.[0m
[32m[2024-05-20 18:14:31] [INFO] [486264] [ThreadPoolExecutor-0_0] [workflow_engine]: [allocate-manager-linux-ubuntu-22.04-amd64] Starting task.[0m
[36m[2024-05-20 18:14:31] [DEBUG] [486264] [ThreadPoolExecutor-0_0] [workflow_engine]: Running task "allocate-manager-linux-ubuntu-22.04-amd64" with arguments: ['modules/allocation/main.py', '--action=create', '--provider=aws', '--size=large', '--composite-name=linux-ubuntu-22.04-amd64', '--inventory-output=/tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml', '--track-output=/tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/track.yaml', '--label-termination-date=1d', '--label-team=qa', '--label-issue=https://github.com/wazuh/wazuh-qa/issues/5191'][0m
[32m[2024-05-20 18:14:31] [INFO] [486264] [ThreadPoolExecutor-0_1] [workflow_engine]: [allocate-macos-agent-macos-ventura-13-amd64] Starting task.[0m
[36m[2024-05-20 18:14:31] [DEBUG] [486264] [ThreadPoolExecutor-0_1] [workflow_engine]: Running task "allocate-macos-agent-macos-ventura-13-amd64" with arguments: ['modules/allocation/main.py', '--action=create', '--provider=vagrant', '--size=small', '--composite-name=macos-ventura-13-amd64', '--inventory-output=/tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml', '--track-output=/tmp/dtt1-poc/agent-macos-ventura-13-amd64/track.yaml', '--label-termination-date=1d', '--label-team=qa', '--label-issue=https://github.com/wazuh/wazuh-qa/issues/5191'][0m
[32m[2024-05-20 18:14:31] [INFO] [486264] [ThreadPoolExecutor-0_2] [workflow_engine]: [allocate-macos-agent-macos-ventura-13-arm64] Starting task.[0m
[36m[2024-05-20 18:14:31] [DEBUG] [486264] [ThreadPoolExecutor-0_2] [workflow_engine]: Running task "allocate-macos-agent-macos-ventura-13-arm64" with arguments: ['modules/allocation/main.py', '--action=create', '--provider=vagrant', '--size=small', '--composite-name=macos-ventura-13-arm64', '--inventory-output=/tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml', '--track-output=/tmp/dtt1-poc/agent-macos-ventura-13-arm64/track.yaml', '--label-termination-date=1d', '--label-team=qa', '--label-issue=https://github.com/wazuh/wazuh-qa/issues/5191'][0m
[32m[2024-05-20 18:14:31] [INFO] [486264] [ThreadPoolExecutor-0_3] [workflow_engine]: [allocate-macos-agent-macos-sonoma-14-amd64] Starting task.[0m
[36m[2024-05-20 18:14:31] [DEBUG] [486264] [ThreadPoolExecutor-0_3] [workflow_engine]: Running task "allocate-macos-agent-macos-sonoma-14-amd64" with arguments: ['modules/allocation/main.py', '--action=create', '--provider=vagrant', '--size=small', '--composite-name=macos-sonoma-14-amd64', '--inventory-output=/tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml', '--track-output=/tmp/dtt1-poc/agent-macos-sonoma-14-amd64/track.yaml', '--label-termination-date=1d', '--label-team=qa', '--label-issue=https://github.com/wazuh/wazuh-qa/issues/5191'][0m
[32m[2024-05-20 18:14:31] [INFO] [486264] [ThreadPoolExecutor-0_4] [workflow_engine]: [allocate-macos-agent-macos-sonoma-14-arm64] Starting task.[0m
[36m[2024-05-20 18:14:31] [DEBUG] [486264] [ThreadPoolExecutor-0_4] [workflow_engine]: Running task "allocate-macos-agent-macos-sonoma-14-arm64" with arguments: ['modules/allocation/main.py', '--action=create', '--provider=vagrant', '--size=small', '--composite-name=macos-sonoma-14-arm64', '--inventory-output=/tmp/dtt1-poc/agent-macos-sonoma-14-arm64/inventory.yaml', '--track-output=/tmp/dtt1-poc/agent-macos-sonoma-14-arm64/track.yaml', '--label-termination-date=1d', '--label-team=qa', '--label-issue=https://github.com/wazuh/wazuh-qa/issues/5191'][0m
[36m[2024-05-20 18:15:25] [DEBUG] [486264] [ThreadPoolExecutor-0_0] [workflow_engine]: Finished task "allocate-manager-linux-ubuntu-22.04-amd64" execution with result:
[37m[2024-05-20 18:14:31] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:14:31] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:14:31] [INFO] ALLOCATOR: Creating instance at /tmp/wazuh-qa[0m
[37m[2024-05-20 18:14:32] [DEBUG] ALLOCATOR: No config provided. Generating from payload[0m
[37m[2024-05-20 18:14:32] [DEBUG] ALLOCATOR: Generating new key pair[0m
[37m[2024-05-20 18:14:32] [DEBUG] ALLOCATOR: Creating base directory: /tmp/wazuh-qa/AWS-CE3FCC29-7398-43F4-B26B-52F48AECDD5F[0m
[37m[2024-05-20 18:14:51] [DEBUG] ALLOCATOR: Renaming temp /tmp/wazuh-qa/AWS-CE3FCC29-7398-43F4-B26B-52F48AECDD5F directory to /tmp/wazuh-qa/i-0e4256e5c7bc34023[0m
[32m[2024-05-20 18:14:51] [INFO] ALLOCATOR: Instance i-0e4256e5c7bc34023 created.[0m
[32m[2024-05-20 18:14:53] [INFO] ALLOCATOR: Instance i-0e4256e5c7bc34023 started.[0m
[32m[2024-05-20 18:14:53] [INFO] ALLOCATOR: The inventory file generated at /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml[0m
[32m[2024-05-20 18:14:53] [INFO] ALLOCATOR: The track file generated at /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/track.yaml[0m
[33m[2024-05-20 18:14:53] [WARNING] ALLOCATOR: Error on attempt 1 of 30: [Errno None] Unable to connect to port 2200 on 54.144.70.59[0m
[32m[2024-05-20 18:15:25] [INFO] ALLOCATOR: SSH connection successful.[0m
[32m[2024-05-20 18:15:25] [INFO] ALLOCATOR: Instance i-0e4256e5c7bc34023 created successfully.[0m
[0m
[32m[2024-05-20 18:15:25] [INFO] [486264] [ThreadPoolExecutor-0_0] [workflow_engine]: [allocate-manager-linux-ubuntu-22.04-amd64] Finished task in 54.27 seconds.[0m
[32m[2024-05-20 18:15:25] [INFO] [486264] [ThreadPoolExecutor-0_0] [workflow_engine]: [provision-manager-linux-ubuntu-22.04-amd64] Starting task.[0m
[36m[2024-05-20 18:15:25] [DEBUG] [486264] [ThreadPoolExecutor-0_0] [workflow_engine]: Running task "provision-manager-linux-ubuntu-22.04-amd64" with arguments: ['modules/provision/main.py', '--inventory=/tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml', "--install={'component': 'wazuh-manager', 'type': 'assistant', 'version': '4.7.4', 'live': True}"][0m
[36m[2024-05-20 18:16:58] [DEBUG] [486264] [ThreadPoolExecutor-0_3] [workflow_engine]: Finished task "allocate-macos-agent-macos-sonoma-14-amd64" execution with result:
[37m[2024-05-20 18:14:31] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:14:31] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:14:31] [INFO] ALLOCATOR: Creating instance at /tmp/wazuh-qa[0m
[32m[2024-05-20 18:14:48] [INFO] ALLOCATOR: Using the macStadium Intel server to deploy.[0m
[37m[2024-05-20 18:14:48] [DEBUG] ALLOCATOR: Checking if instance directory exists on remote host[0m
[37m[2024-05-20 18:14:53] [DEBUG] ALLOCATOR: Creating instance directory on remote host[0m
[37m[2024-05-20 18:14:59] [DEBUG] ALLOCATOR: No config provided. Generating from payload[0m
[37m[2024-05-20 18:14:59] [DEBUG] ALLOCATOR: Generating new key pair[0m
[37m[2024-05-20 18:15:03] [DEBUG] ALLOCATOR: Vagrantfile created. Creating instance.[0m
[32m[2024-05-20 18:15:18] [INFO] ALLOCATOR: Instance qa-5191-sonoma-14-9588 created.[0m
[32m[2024-05-20 18:16:24] [INFO] ALLOCATOR: Instance qa-5191-sonoma-14-9588 started.[0m
[32m[2024-05-20 18:16:54] [INFO] ALLOCATOR: The inventory file generated at /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml[0m
[32m[2024-05-20 18:16:54] [INFO] ALLOCATOR: The track file generated at /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/track.yaml[0m
[32m[2024-05-20 18:16:58] [INFO] ALLOCATOR: SSH connection successful.[0m
[32m[2024-05-20 18:16:58] [INFO] ALLOCATOR: Instance qa-5191-sonoma-14-9588 created successfully.[0m
[0m
[32m[2024-05-20 18:16:58] [INFO] [486264] [ThreadPoolExecutor-0_3] [workflow_engine]: [allocate-macos-agent-macos-sonoma-14-amd64] Finished task in 147.71 seconds.[0m
[36m[2024-05-20 18:16:59] [DEBUG] [486264] [ThreadPoolExecutor-0_1] [workflow_engine]: Finished task "allocate-macos-agent-macos-ventura-13-amd64" execution with result:
[37m[2024-05-20 18:14:31] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:14:31] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:14:31] [INFO] ALLOCATOR: Creating instance at /tmp/wazuh-qa[0m
[32m[2024-05-20 18:14:48] [INFO] ALLOCATOR: Using the macStadium Intel server to deploy.[0m
[37m[2024-05-20 18:14:48] [DEBUG] ALLOCATOR: Checking if instance directory exists on remote host[0m
[37m[2024-05-20 18:14:53] [DEBUG] ALLOCATOR: Creating instance directory on remote host[0m
[37m[2024-05-20 18:14:59] [DEBUG] ALLOCATOR: No config provided. Generating from payload[0m
[37m[2024-05-20 18:14:59] [DEBUG] ALLOCATOR: Generating new key pair[0m
[37m[2024-05-20 18:15:03] [DEBUG] ALLOCATOR: Vagrantfile created. Creating instance.[0m
[32m[2024-05-20 18:15:18] [INFO] ALLOCATOR: Instance qa-5191-ventura-13-3162 created.[0m
[32m[2024-05-20 18:16:20] [INFO] ALLOCATOR: Instance qa-5191-ventura-13-3162 started.[0m
[32m[2024-05-20 18:16:55] [INFO] ALLOCATOR: The inventory file generated at /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml[0m
[32m[2024-05-20 18:16:55] [INFO] ALLOCATOR: The track file generated at /tmp/dtt1-poc/agent-macos-ventura-13-amd64/track.yaml[0m
[32m[2024-05-20 18:16:59] [INFO] ALLOCATOR: SSH connection successful.[0m
[32m[2024-05-20 18:16:59] [INFO] ALLOCATOR: Instance qa-5191-ventura-13-3162 created successfully.[0m
[0m
[32m[2024-05-20 18:16:59] [INFO] [486264] [ThreadPoolExecutor-0_1] [workflow_engine]: [allocate-macos-agent-macos-ventura-13-amd64] Finished task in 148.75 seconds.[0m
[36m[2024-05-20 18:17:06] [DEBUG] [486264] [ThreadPoolExecutor-0_2] [workflow_engine]: Finished task "allocate-macos-agent-macos-ventura-13-arm64" execution with result:
[37m[2024-05-20 18:14:31] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:14:31] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:14:31] [INFO] ALLOCATOR: Creating instance at /tmp/wazuh-qa[0m
[32m[2024-05-20 18:14:39] [INFO] ALLOCATOR: macStadium ARM server has less than 2 VMs running, deploying in this host.[0m
[37m[2024-05-20 18:14:39] [DEBUG] ALLOCATOR: Checking if instance directory exists on remote host[0m
[37m[2024-05-20 18:14:45] [DEBUG] ALLOCATOR: Creating instance directory on remote host[0m
[37m[2024-05-20 18:14:50] [DEBUG] ALLOCATOR: No config provided. Generating from payload[0m
[37m[2024-05-20 18:14:50] [DEBUG] ALLOCATOR: Generating new key pair[0m
[37m[2024-05-20 18:14:53] [DEBUG] ALLOCATOR: Vagrantfile created. Creating instance.[0m
[32m[2024-05-20 18:15:10] [INFO] ALLOCATOR: Instance qa-5191-ventura-13-2119 created.[0m
[32m[2024-05-20 18:16:36] [INFO] ALLOCATOR: Instance qa-5191-ventura-13-2119 started.[0m
[32m[2024-05-20 18:17:01] [INFO] ALLOCATOR: The inventory file generated at /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml[0m
[32m[2024-05-20 18:17:01] [INFO] ALLOCATOR: The track file generated at /tmp/dtt1-poc/agent-macos-ventura-13-arm64/track.yaml[0m
[32m[2024-05-20 18:17:06] [INFO] ALLOCATOR: SSH connection successful.[0m
[32m[2024-05-20 18:17:06] [INFO] ALLOCATOR: Instance qa-5191-ventura-13-2119 created successfully.[0m
[0m
[32m[2024-05-20 18:17:06] [INFO] [486264] [ThreadPoolExecutor-0_2] [workflow_engine]: [allocate-macos-agent-macos-ventura-13-arm64] Finished task in 155.43 seconds.[0m
[36m[2024-05-20 18:20:32] [DEBUG] [486264] [ThreadPoolExecutor-0_0] [workflow_engine]: Finished task "provision-manager-linux-ubuntu-22.04-amd64" execution with result:
[37m[2024-05-20 18:15:25] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:15:25] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[37m[2024-05-20 18:15:25] [DEBUG] PROVISIONER: Setting dependencies: {} for wazuh-manager component.[0m
[32m[2024-05-20 18:15:25] [INFO] PROVISIONER: Initiating provisionment.[0m
[37m[2024-05-20 18:15:25] [DEBUG] PROVISIONER: Running action install for components: [ComponentInfo(component='wazuh-manager', type='assistant', version='4.7.4', dependencies=None, live=True)][0m
[32m[2024-05-20 18:15:25] [INFO] PROVISIONER: Provisioning "wazuh-manager"...[0m
[37m[2024-05-20 18:15:25] [DEBUG] PROVISIONER: Get OS family for ec2-54-144-70-59.compute-1.amazonaws.com.[0m
[37m[2024-05-20 18:15:25] [DEBUG] PROVISIONER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:15:25] [DEBUG] PROVISIONER: Running playbook: {'hosts': 'ec2-54-144-70-59.compute-1.amazonaws.com', 'become': True, 'gather_facts': True, 'tasks': [{'name': 'Capture ansible_os_family', 'set_fact': {'ansible_os_family': "{{ ansible_facts['distribution_file_variety'] }}", 'cacheable': 'yes'}}]}[0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [ec2-54-144-70-59.compute-1.amazonaws.com] ********************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com][0m

TASK [Capture ansible_os_family] ***********************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=false [0m
[0;32m  ansible_facts:[0m
[0;32m    ansible_os_family: Debian[0m

PLAY RECAP *********************************************************************
[0;32mec2-54-144-70-59.compute-1.amazonaws.com[0m : [0;32mok=2   [0m changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: Playbook {'hosts': 'ec2-54-144-70-59.compute-1.amazonaws.com', 'become': True, 'gather_facts': True, 'tasks': [{'name': 'Capture ansible_os_family', 'set_fact': {'ansible_os_family': "{{ ansible_facts['distribution_file_variety'] }}", 'cacheable': 'yes'}}]} finished with status {'skipped': {}, 'ok': {'ec2-54-144-70-59.compute-1.amazonaws.com': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 1}, 'changed': {}}[0m
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: OS family: Debian.[0m
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: Render playbook with vars: {'component': 'wazuh-manager', 'version': '4.7.4', 'live': True, 'type': 'assistant', 'dependencies': None, 'templates_path': '/home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/playbooks/wazuh/assistant/install', 'templates_order': ['download.j2', 'install.j2'], 'ansible_os_family': 'Debian'}.[0m
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: Templates found: ['download.j2', 'install.j2'][0m
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: Rendering template download.j2[0m
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: Rendering template install.j2[0m
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: [{'name': 'Install the required packages', 'shell': '\nsudo apt-get update && apt-get -y install curl\n'}, {'name': 'Download the Wazuh installation assistant', 'shell': 'curl -sO https://packages.wazuh.com/4.7/wazuh-install.sh'}, {'name': 'Install wazuh-manager with assistant', 'shell': 'bash ./wazuh-install.sh -a -i'}][0m
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: Tasks to execute: [{'name': 'Install the required packages', 'shell': '\nsudo apt-get update && apt-get -y install curl\n'}, {'name': 'Download the Wazuh installation assistant', 'shell': 'curl -sO https://packages.wazuh.com/4.7/wazuh-install.sh'}, {'name': 'Install wazuh-manager with assistant', 'shell': 'bash ./wazuh-install.sh -a -i'}].[0m
[32m[2024-05-20 18:15:36] [INFO] PROVISIONER: Execute install for wazuh-manager.[0m
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:15:36] [DEBUG] PROVISIONER: Running playbook: {'hosts': 'ec2-54-144-70-59.compute-1.amazonaws.com', 'become': True, 'gather_facts': True, 'tasks': [{'name': 'Install the required packages', 'shell': '\nsudo apt-get update && apt-get -y install curl\n'}, {'name': 'Download the Wazuh installation assistant', 'shell': 'curl -sO https://packages.wazuh.com/4.7/wazuh-install.sh'}, {'name': 'Install wazuh-manager with assistant', 'shell': 'bash ./wazuh-install.sh -a -i'}]}[0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [ec2-54-144-70-59.compute-1.amazonaws.com] ********************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com][0m

TASK [Install the required packages] *******************************************
[0;33mchanged: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=true [0m
[0;33m  cmd: |2-[0m
[0;33m  [0m
[0;33m    sudo apt-get update && apt-get -y install curl[0m
[0;33m  delta: '0:00:16.030227'[0m
[0;33m  end: '2024-05-20 21:16:03.129051'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 21:15:47.098824'[0m
[0;33m  stderr: ''[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    Hit:1 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy InRelease[0m
[0;33m    Get:2 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates InRelease [119 kB][0m
[0;33m    Get:3 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-backports InRelease [109 kB][0m
[0;33m    Get:4 http://security.ubuntu.com/ubuntu jammy-security InRelease [110 kB][0m
[0;33m    Get:5 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB][0m
[0;33m    Get:6 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB][0m
[0;33m    Get:7 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB][0m
[0;33m    Get:8 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB][0m
[0;33m    Get:9 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB][0m
[0;33m    Get:10 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B][0m
[0;33m    Get:11 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [1681 kB][0m
[0;33m    Get:12 http://security.ubuntu.com/ubuntu jammy-security/main amd64 Packages [1468 kB][0m
[0;33m    Get:13 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [311 kB][0m
[0;33m    Get:14 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [16.1 kB][0m
[0;33m    Get:15 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [1928 kB][0m
[0;33m    Get:16 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [327 kB][0m
[0;33m    Get:17 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 c-n-f Metadata [520 B][0m
[0;33m    Get:18 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1074 kB][0m
[0;33m    Get:19 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [246 kB][0m
[0;33m    Get:20 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [22.1 kB][0m
[0;33m    Get:21 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [42.7 kB][0m
[0;33m    Get:22 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [10.4 kB][0m
[0;33m    Get:23 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [472 B][0m
[0;33m    Get:24 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [67.1 kB][0m
[0;33m    Get:25 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.0 kB][0m
[0;33m    Get:26 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [388 B][0m
[0;33m    Get:27 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B][0m
[0;33m    Get:28 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [27.2 kB][0m
[0;33m    Get:29 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.2 kB][0m
[0;33m    Get:30 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [644 B][0m
[0;33m    Get:31 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B][0m
[0;33m    Get:32 http://security.ubuntu.com/ubuntu jammy-security/main Translation-en [253 kB][0m
[0;33m    Get:33 http://security.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [11.4 kB][0m
[0;33m    Get:34 http://security.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [1871 kB][0m
[0;33m    Get:35 http://security.ubuntu.com/ubuntu jammy-security/restricted Translation-en [317 kB][0m
[0;33m    Get:36 http://security.ubuntu.com/ubuntu jammy-security/restricted amd64 c-n-f Metadata [520 B][0m
[0;33m    Get:37 http://security.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [852 kB][0m
[0;33m    Get:38 http://security.ubuntu.com/ubuntu jammy-security/universe Translation-en [164 kB][0m
[0;33m    Get:39 http://security.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [16.8 kB][0m
[0;33m    Get:40 http://security.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [37.2 kB][0m
[0;33m    Get:41 http://security.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [7588 B][0m
[0;33m    Get:42 http://security.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [260 B][0m
[0;33m    Fetched 31.5 MB in 3s (10.1 MB/s)[0m
[0;33m    Reading package lists...[0m
[0;33m    Reading package lists...[0m
[0;33m    Building dependency tree...[0m
[0;33m    Reading state information...[0m
[0;33m    The following additional packages will be installed:[0m
[0;33m      libcurl4[0m
[0;33m    The following packages will be upgraded:[0m
[0;33m      curl libcurl4[0m
[0;33m    2 upgraded, 0 newly installed, 0 to remove and 192 not upgraded.[0m
[0;33m    Need to get 484 kB of archives.[0m
[0;33m    After this operation, 0 B of additional disk space will be used.[0m
[0;33m    Get:1 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/main amd64 curl amd64 7.81.0-1ubuntu1.16 [194 kB][0m
[0;33m    Get:2 http://us-east-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libcurl4 amd64 7.81.0-1ubuntu1.16 [290 kB][0m
[0;33m    Fetched 484 kB in 0s (16.0 MB/s)[0m
[0;33m    (Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 64295 files and directories currently installed.)[0m
[0;33m    Preparing to unpack .../curl_7.81.0-1ubuntu1.16_amd64.deb ...[0m
[0;33m    Unpacking curl (7.81.0-1ubuntu1.16) over (7.81.0-1ubuntu1.10) ...[0m
[0;33m    Preparing to unpack .../libcurl4_7.81.0-1ubuntu1.16_amd64.deb ...[0m
[0;33m    Unpacking libcurl4:amd64 (7.81.0-1ubuntu1.16) over (7.81.0-1ubuntu1.10) ...[0m
[0;33m    Setting up libcurl4:amd64 (7.81.0-1ubuntu1.16) ...[0m
[0;33m    Setting up curl (7.81.0-1ubuntu1.16) ...[0m
[0;33m    Processing triggers for man-db (2.10.2-1) ...[0m
[0;33m    Processing triggers for libc-bin (2.35-0ubuntu3.1) ...[0m
[0;33m  stdout_lines: <omitted>[0m

TASK [Download the Wazuh installation assistant] *******************************
[0;33mchanged: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=true [0m
[0;33m  cmd: curl -sO https://packages.wazuh.com/4.7/wazuh-install.sh[0m
[0;33m  delta: '0:00:00.078395'[0m
[0;33m  end: '2024-05-20 21:16:07.505254'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 21:16:07.426859'[0m
[0;33m  stderr: ''[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: ''[0m
[0;33m  stdout_lines: <omitted>[0m

TASK [Install wazuh-manager with assistant] ************************************
[0;33mchanged: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=true [0m
[0;33m  cmd: bash ./wazuh-install.sh -a -i[0m
[0;33m  delta: '0:04:19.755051'[0m
[0;33m  end: '2024-05-20 21:20:31.584216'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 21:16:11.829165'[0m
[0;33m  stderr: ''[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    20/05/2024 21:16:11 INFO: Starting Wazuh installation assistant. Wazuh version: 4.7.4[0m
[0;33m    20/05/2024 21:16:11 INFO: Verbose logging redirected to /var/log/wazuh-install.log[0m
[0;33m    20/05/2024 21:16:16 WARNING: Hardware and system checks ignored.[0m
[0;33m    20/05/2024 21:16:16 INFO: Wazuh web interface port will be 443.[0m
[0;33m    20/05/2024 21:16:19 INFO: --- Dependencies ----[0m
[0;33m    20/05/2024 21:16:19 INFO: Installing apt-transport-https.[0m
[0;33m    20/05/2024 21:16:26 INFO: Wazuh repository added.[0m
[0;33m    20/05/2024 21:16:26 INFO: --- Configuration files ---[0m
[0;33m    20/05/2024 21:16:26 INFO: Generating configuration files.[0m
[0;33m    20/05/2024 21:16:28 INFO: Created wazuh-install-files.tar. It contains the Wazuh cluster key, certificates, and passwords necessary for installation.[0m
[0;33m    20/05/2024 21:16:28 INFO: --- Wazuh indexer ---[0m
[0;33m    20/05/2024 21:16:28 INFO: Starting Wazuh indexer installation.[0m
[0;33m    20/05/2024 21:17:44 INFO: Wazuh indexer installation finished.[0m
[0;33m    20/05/2024 21:17:44 INFO: Wazuh indexer post-install configuration finished.[0m
[0;33m    20/05/2024 21:17:44 INFO: Starting service wazuh-indexer.[0m
[0;33m    20/05/2024 21:17:55 INFO: wazuh-indexer service started.[0m
[0;33m    20/05/2024 21:17:55 INFO: Initializing Wazuh indexer cluster security settings.[0m
[0;33m    20/05/2024 21:18:06 INFO: Wazuh indexer cluster initialized.[0m
[0;33m    20/05/2024 21:18:06 INFO: --- Wazuh server ---[0m
[0;33m    20/05/2024 21:18:06 INFO: Starting the Wazuh manager installation.[0m
[0;33m    20/05/2024 21:18:56 INFO: Wazuh manager installation finished.[0m
[0;33m    20/05/2024 21:18:56 INFO: Starting service wazuh-manager.[0m
[0;33m    20/05/2024 21:19:11 INFO: wazuh-manager service started.[0m
[0;33m    20/05/2024 21:19:11 INFO: Starting Filebeat installation.[0m
[0;33m    20/05/2024 21:19:18 INFO: Filebeat installation finished.[0m
[0;33m    20/05/2024 21:19:18 INFO: Filebeat post-install configuration finished.[0m
[0;33m    20/05/2024 21:19:18 INFO: Starting service filebeat.[0m
[0;33m    20/05/2024 21:19:19 INFO: filebeat service started.[0m
[0;33m    20/05/2024 21:19:19 INFO: --- Wazuh dashboard ---[0m
[0;33m    20/05/2024 21:19:19 INFO: Starting Wazuh dashboard installation.[0m
[0;33m    20/05/2024 21:20:11 INFO: Wazuh dashboard installation finished.[0m
[0;33m    20/05/2024 21:20:11 INFO: Wazuh dashboard post-install configuration finished.[0m
[0;33m    20/05/2024 21:20:11 INFO: Starting service wazuh-dashboard.[0m
[0;33m    20/05/2024 21:20:11 INFO: wazuh-dashboard service started.[0m
[0;33m    20/05/2024 21:20:31 INFO: Initializing Wazuh dashboard web application.[0m
[0;33m    20/05/2024 21:20:31 INFO: Wazuh dashboard web application initialized.[0m
[0;33m    20/05/2024 21:20:31 INFO: --- Summary ---[0m
[0;33m    20/05/2024 21:20:31 INFO: You can access the web interface https://<wazuh-dashboard-ip>:443[0m
[0;33m        User: admin[0m
[0;33m        Password: +DOEDrBMF+4i77PRfjxLSPBSg1h?p5Qz[0m
[0;33m    20/05/2024 21:20:31 INFO: Installation finished.[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mec2-54-144-70-59.compute-1.amazonaws.com[0m : [0;32mok=4   [0m [0;33mchanged=3   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:20:32] [DEBUG] PROVISIONER: Playbook {'hosts': 'ec2-54-144-70-59.compute-1.amazonaws.com', 'become': True, 'gather_facts': True, 'tasks': [{'name': 'Install the required packages', 'shell': '\nsudo apt-get update && apt-get -y install curl\n'}, {'name': 'Download the Wazuh installation assistant', 'shell': 'curl -sO https://packages.wazuh.com/4.7/wazuh-install.sh'}, {'name': 'Install wazuh-manager with assistant', 'shell': 'bash ./wazuh-install.sh -a -i'}]} finished with status {'skipped': {}, 'ok': {'ec2-54-144-70-59.compute-1.amazonaws.com': 4}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 1}, 'changed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 3}}[0m
[32m[2024-05-20 18:20:32] [INFO] PROVISIONER: Provision of "wazuh-manager" complete successfully.[0m
[32m[2024-05-20 18:20:32] [INFO] PROVISIONER: All components provisioned successfully.[0m
[37m[2024-05-20 18:20:32] [DEBUG] PROVISIONER: Provision summary: {'skipped': {}, 'ok': {'ec2-54-144-70-59.compute-1.amazonaws.com': 4}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 1}, 'changed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 3}}[0m
[0m
[32m[2024-05-20 18:20:32] [INFO] [486264] [ThreadPoolExecutor-0_0] [workflow_engine]: [provision-manager-linux-ubuntu-22.04-amd64] Finished task in 307.12 seconds.[0m
[32m[2024-05-20 18:20:32] [INFO] [486264] [ThreadPoolExecutor-0_3] [workflow_engine]: [run-agent-macos-ventura-13-amd64-tests] Starting task.[0m
[32m[2024-05-20 18:20:32] [INFO] [486264] [ThreadPoolExecutor-0_1] [workflow_engine]: [run-agent-macos-ventura-13-arm64-tests] Starting task.[0m
[36m[2024-05-20 18:20:32] [DEBUG] [486264] [ThreadPoolExecutor-0_3] [workflow_engine]: Running task "run-agent-macos-ventura-13-amd64-tests" with arguments: ['modules/testing/main.py', "--targets={'wazuh-1': '/tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml'}", "--targets={'agent': '/tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml'}", '--tests=install,registration,basic_info', '--component=agent', '--wazuh-version=4.7.4', '--wazuh-revision=40717', '--live=True'][0m
[32m[2024-05-20 18:20:32] [INFO] [486264] [ThreadPoolExecutor-0_2] [workflow_engine]: [run-agent-macos-sonoma-14-amd64-tests] Starting task.[0m
[36m[2024-05-20 18:20:32] [DEBUG] [486264] [ThreadPoolExecutor-0_1] [workflow_engine]: Running task "run-agent-macos-ventura-13-arm64-tests" with arguments: ['modules/testing/main.py', "--targets={'wazuh-1': '/tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml'}", "--targets={'agent': '/tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml'}", '--tests=install,registration,basic_info', '--component=agent', '--wazuh-version=4.7.4', '--wazuh-revision=40717', '--live=True'][0m
[36m[2024-05-20 18:20:32] [DEBUG] [486264] [ThreadPoolExecutor-0_2] [workflow_engine]: Running task "run-agent-macos-sonoma-14-amd64-tests" with arguments: ['modules/testing/main.py', "--targets={'wazuh-1': '/tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml'}", "--targets={'agent': '/tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml'}", '--tests=install,registration,basic_info', '--component=agent', '--wazuh-version=4.7.4', '--wazuh-revision=40717', '--live=True'][0m
[31m[2024-05-20 18:22:52] [ERROR] [486264] [ThreadPoolExecutor-0_4] [workflow_engine]: [allocate-macos-agent-macos-sonoma-14-arm64] Task failed with error: Error executing process task Traceback (most recent call last):
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/main.py", line 39, in <module>
    main()
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/main.py", line 35, in main
    Allocator.run(InputPayload(**vars(parse_arguments())))
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/allocation.py", line 40, in run
    return cls.__create(payload)
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/allocation.py", line 66, in __create
    inventory = cls.__generate_inventory(instance, instance_params.composite_name)
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/allocation.py", line 130, in __generate_inventory
    ssh_config = instance.ssh_connection_info()
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/vagrant/instance.py", line 174, in ssh_connection_info
    cmd = f"/usr/bin/ssh -i /Users/jenkins/.ssh/localhost -L {server_ip}:{port}:{ip}:22 -N 127.0.0.1 -f"
UnboundLocalError: local variable 'ip' referenced before assignment
.[0m
[33m[2024-05-20 18:22:52] [WARNING] [486264] [ThreadPoolExecutor-0_0] [workflow_engine]: [run-agent-macos-sonoma-14-arm64-tests] Skipping task due to dependency failure.[0m
[36m[2024-05-20 18:24:20] [DEBUG] [486264] [ThreadPoolExecutor-0_2] [workflow_engine]: Finished task "run-agent-macos-sonoma-14-amd64-tests" execution with result:
[37m[2024-05-20 18:20:32] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:20:32] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:20:33] [INFO] TESTER: Running tests for ec2-54-144-70-59.compute-1.amazonaws.com[0m
[32m[2024-05-20 18:20:33] [INFO] TESTER: Running tests for 10.10.0.249[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Using extra vars: {'component': 'agent', 'wazuh_version': '4.7.4', 'wazuh_revision': '40717', 'wazuh_branch': None, 'working_dir': '/tmp/tests', 'live': True, 'hosts_ip': ['ec2-54-144-70-59.compute-1.amazonaws.com', '10.10.0.249'], 'targets': '{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}', 'dependencies': '{}', 'local_host_path': '/home/fcaffieri/repos/wazuh-qa/deployability', 'current_user': 'fcaffieri'}[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/setup.yml[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Cleaning old key ssh-keygen registries', 'ansible.builtin.command': {'cmd': "ssh-keygen -f /home/fcaffieri/.ssh/known_hosts -R ''"}, 'loop': ['ec2-54-144-70-59.compute-1.amazonaws.com', '10.10.0.249']}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Cleaning old key ssh-keygen registries] **********************************
[0;33mchanged: [localhost] => (item=ec2-54-144-70-59.compute-1.amazonaws.com) => changed=true [0m
[0;33m  ansible_loop_var: item[0m
[0;33m  cmd:[0m
[0;33m  - ssh-keygen[0m
[0;33m  - -f[0m
[0;33m  - /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  - -R[0m
[0;33m  - ''[0m
[0;33m  delta: '0:00:00.005604'[0m
[0;33m  end: '2024-05-20 18:20:36.070220'[0m
[0;33m  item: ec2-54-144-70-59.compute-1.amazonaws.com[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:20:36.064616'[0m
[0;33m  stderr: Host  not found in /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: ''[0m
[0;33m  stdout_lines: <omitted>[0m
[0;33mchanged: [localhost] => (item=10.10.0.249) => changed=true [0m
[0;33m  ansible_loop_var: item[0m
[0;33m  cmd:[0m
[0;33m  - ssh-keygen[0m
[0;33m  - -f[0m
[0;33m  - /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  - -R[0m
[0;33m  - ''[0m
[0;33m  delta: '0:00:00.005677'[0m
[0;33m  end: '2024-05-20 18:20:36.278792'[0m
[0;33m  item: 10.10.0.249[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:20:36.273115'[0m
[0;33m  stderr: Host  not found in /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: ''[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Cleaning old key ssh-keygen registries', 'ansible.builtin.command': {'cmd': "ssh-keygen -f /home/fcaffieri/.ssh/known_hosts -R ''"}, 'loop': ['ec2-54-144-70-59.compute-1.amazonaws.com', '10.10.0.249']}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/test.yml[0m
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test install for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_install.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Test install for agent] **************************************************
[0;33mchanged: [localhost] => changed=true [0m
[0;33m  cmd:[0m
[0;33m  - python3[0m
[0;33m  - -m[0m
[0;33m  - pytest[0m
[0;33m  - modules/testing/tests/test_agent/test_install.py[0m
[0;33m  - -v[0m
[0;33m  - --wazuh_version=4.7.4[0m
[0;33m  - --wazuh_revision=40717[0m
[0;33m  - --component=agent[0m
[0;33m  - --dependencies={}[0m
[0;33m  - '--targets={wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}'[0m
[0;33m  - --live=True[0m
[0;33m  - -s[0m
[0;33m  delta: '0:00:55.232144'[0m
[0;33m  end: '2024-05-20 18:21:35.603508'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:20:40.371364'[0m
[0;33m  stderr: |-[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    [37m[2024-05-20 18:20:40] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m[0m
[0;33m    [37m[2024-05-20 18:20:40] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m[0m
[0;33m    ============================= test session starts ==============================[0m
[0;33m    platform linux -- Python 3.10.14, pytest-7.4.4, pluggy-1.4.0 -- /home/fcaffieri/repos/wazuh-qa/.venv/bin/python3[0m
[0;33m    cachedir: .pytest_cache[0m
[0;33m    rootdir: /home/fcaffieri/repos/wazuh-qa/deployability/modules[0m
[0;33m    collecting ... collected 2 items[0m
[0;33m  [0m
[0;33m    modules/testing/tests/test_agent/test_install.py::test_installation [32m[2024-05-20 18:20:41] [INFO] TESTER: Checking connection to sonoma-14[0m[0m
[0;33m    [32m[2024-05-20 18:20:45] [INFO] TESTER: Connection established successfully in sonoma-14[0m[0m
[0;33m    [32m[2024-05-20 18:20:50] [INFO] TESTER: Checking connection to ubuntu-22.04[0m[0m
[0;33m    [32m[2024-05-20 18:20:52] [INFO] TESTER: Connection established successfully in ubuntu-22.04[0m[0m
[0;33m    [32m[2024-05-20 18:20:52] [INFO] TESTER: Firewall disabled on sonoma-14[0m[0m
[0;33m    [32m[2024-05-20 18:21:00] [INFO] TESTER: Manager is already installed in ubuntu-22.04[0m[0m
[0;33m    [32m[2024-05-20 18:21:03] [INFO] TESTER: Installing Agent in sonoma-14[0m[0m
[0;33m    PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_install.py::test_status [32m[2024-05-20 18:21:30] [INFO] TESTER: Getting status of sonoma-14[0m[0m
[0;33m    PASSED[0m
[0;33m  [0m
[0;33m    =============================== warnings summary ===============================[0m
[0;33m    modules/provision/models.py:36[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:36: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('dependencies', pre=True)[0m
[0;33m  [0m
[0;33m    modules/provision/models.py:64[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:64: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('install', 'uninstall', pre=True)[0m
[0;33m  [0m
[0;33m    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html[0m
[0;33m    ======================== 2 passed, 2 warnings in 54.32s ========================[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:21:35] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test install for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_install.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[37m[2024-05-20 18:21:35] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/test.yml[0m
[37m[2024-05-20 18:21:35] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:21:35] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test registration for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_registration.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Test registration for agent] *********************************************
[0;33mchanged: [localhost] => changed=true [0m
[0;33m  cmd:[0m
[0;33m  - python3[0m
[0;33m  - -m[0m
[0;33m  - pytest[0m
[0;33m  - modules/testing/tests/test_agent/test_registration.py[0m
[0;33m  - -v[0m
[0;33m  - --wazuh_version=4.7.4[0m
[0;33m  - --wazuh_revision=40717[0m
[0;33m  - --component=agent[0m
[0;33m  - --dependencies={}[0m
[0;33m  - '--targets={wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}'[0m
[0;33m  - --live=True[0m
[0;33m  - -s[0m
[0;33m  delta: '0:01:20.275258'[0m
[0;33m  end: '2024-05-20 18:22:58.379567'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:21:38.104309'[0m
[0;33m  stderr: |-[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    [37m[2024-05-20 18:21:38] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m[0m
[0;33m    [37m[2024-05-20 18:21:38] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m[0m
[0;33m    ============================= test session starts ==============================[0m
[0;33m    platform linux -- Python 3.10.14, pytest-7.4.4, pluggy-1.4.0 -- /home/fcaffieri/repos/wazuh-qa/.venv/bin/python3[0m
[0;33m    cachedir: .pytest_cache[0m
[0;33m    rootdir: /home/fcaffieri/repos/wazuh-qa/deployability/modules[0m
[0;33m    collecting ... collected 4 items[0m
[0;33m  [0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_status [32m[2024-05-20 18:21:38] [INFO] TESTER: Checking connection to sonoma-14[0m[0m
[0;33m    [32m[2024-05-20 18:21:43] [INFO] TESTER: Connection established successfully in sonoma-14[0m[0m
[0;33m    [32m[2024-05-20 18:21:57] [INFO] TESTER: Registering agent in sonoma-14[0m[0m
[0;33m    [32m[2024-05-20 18:22:20] [INFO] TESTER: Getting status of sonoma-14[0m[0m
[0;33m    PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_service PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_connection PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_clientKeys PASSED[0m
[0;33m  [0m
[0;33m    =============================== warnings summary ===============================[0m
[0;33m    modules/provision/models.py:36[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:36: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('dependencies', pre=True)[0m
[0;33m  [0m
[0;33m    modules/provision/models.py:64[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:64: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('install', 'uninstall', pre=True)[0m
[0;33m  [0m
[0;33m    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html[0m
[0;33m    =================== 4 passed, 2 warnings in 79.47s (0:01:19) ===================[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:22:58] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test registration for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_registration.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[37m[2024-05-20 18:22:58] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/test.yml[0m
[37m[2024-05-20 18:22:58] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:22:58] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test basic_info for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_basic_info.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Test basic_info for agent] ***********************************************
[0;33mchanged: [localhost] => changed=true [0m
[0;33m  cmd:[0m
[0;33m  - python3[0m
[0;33m  - -m[0m
[0;33m  - pytest[0m
[0;33m  - modules/testing/tests/test_agent/test_basic_info.py[0m
[0;33m  - -v[0m
[0;33m  - --wazuh_version=4.7.4[0m
[0;33m  - --wazuh_revision=40717[0m
[0;33m  - --component=agent[0m
[0;33m  - --dependencies={}[0m
[0;33m  - '--targets={wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}'[0m
[0;33m  - --live=True[0m
[0;33m  - -s[0m
[0;33m  delta: '0:00:56.345181'[0m
[0;33m  end: '2024-05-20 18:23:57.581912'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:23:01.236731'[0m
[0;33m  stderr: |-[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    [37m[2024-05-20 18:23:01] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m[0m
[0;33m    [37m[2024-05-20 18:23:01] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m[0m
[0;33m    ============================= test session starts ==============================[0m
[0;33m    platform linux -- Python 3.10.14, pytest-7.4.4, pluggy-1.4.0 -- /home/fcaffieri/repos/wazuh-qa/.venv/bin/python3[0m
[0;33m    cachedir: .pytest_cache[0m
[0;33m    rootdir: /home/fcaffieri/repos/wazuh-qa/deployability/modules[0m
[0;33m    collecting ... collected 3 items[0m
[0;33m  [0m
[0;33m    modules/testing/tests/test_agent/test_basic_info.py::test_wazuh_os_version [32m[2024-05-20 18:23:02] [INFO] TESTER: Checking connection to sonoma-14[0m[0m
[0;33m    [32m[2024-05-20 18:23:06] [INFO] TESTER: Connection established successfully in sonoma-14[0m[0m
[0;33m    [32m[2024-05-20 18:23:47] [INFO] TESTER: Version obtained from agent: 14.4.1[0m[0m
[0;33m    [32m[2024-05-20 18:23:47] [INFO] TESTER: Version obtained from Wazuh API: 14.4.1[0m[0m
[0;33m    PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_basic_info.py::test_wazuh_version PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_basic_info.py::test_wazuh_revision PASSED[0m
[0;33m  [0m
[0;33m    =============================== warnings summary ===============================[0m
[0;33m    modules/provision/models.py:36[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:36: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('dependencies', pre=True)[0m
[0;33m  [0m
[0;33m    modules/provision/models.py:64[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:64: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('install', 'uninstall', pre=True)[0m
[0;33m  [0m
[0;33m    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html[0m
[0;33m    ======================== 3 passed, 2 warnings in 55.47s ========================[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:23:57] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test basic_info for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_basic_info.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[32m[2024-05-20 18:23:57] [INFO] TESTER: Cleaning up[0m
[37m[2024-05-20 18:23:57] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:23:57] [DEBUG] TESTER: Running playbook: /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml[0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [all] *********************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com][0m

TASK [Clean test directory] ****************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=false [0m
[0;32m  path: /tmp/tests[0m
[0;32m  state: absent[0m

PLAY RECAP *********************************************************************
[0;32mec2-54-144-70-59.compute-1.amazonaws.com[0m : [0;32mok=2   [0m changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:24:10] [DEBUG] TESTER: Playbook /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml finished with status {'skipped': {}, 'ok': {'ec2-54-144-70-59.compute-1.amazonaws.com': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 1}, 'changed': {}}[0m
[32m[2024-05-20 18:24:10] [INFO] TESTER: Cleaning up[0m
[37m[2024-05-20 18:24:10] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:24:10] [DEBUG] TESTER: Running playbook: /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml[0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [all] *********************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com][0m

TASK [Clean test directory] ****************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=false [0m
[0;32m  path: /tmp/tests[0m
[0;32m  state: absent[0m

PLAY RECAP *********************************************************************
[0;32mec2-54-144-70-59.compute-1.amazonaws.com[0m : [0;32mok=2   [0m changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:24:20] [DEBUG] TESTER: Playbook /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml finished with status {'skipped': {}, 'ok': {'ec2-54-144-70-59.compute-1.amazonaws.com': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 1}, 'changed': {}}[0m
[0m
[32m[2024-05-20 18:24:20] [INFO] [486264] [ThreadPoolExecutor-0_2] [workflow_engine]: [run-agent-macos-sonoma-14-amd64-tests] Finished task in 228.14 seconds.[0m
[36m[2024-05-20 18:24:21] [DEBUG] [486264] [ThreadPoolExecutor-0_3] [workflow_engine]: Finished task "run-agent-macos-ventura-13-amd64-tests" execution with result:
[37m[2024-05-20 18:20:32] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:20:32] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:20:33] [INFO] TESTER: Running tests for ec2-54-144-70-59.compute-1.amazonaws.com[0m
[32m[2024-05-20 18:20:33] [INFO] TESTER: Running tests for 10.10.0.249[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Using extra vars: {'component': 'agent', 'wazuh_version': '4.7.4', 'wazuh_revision': '40717', 'wazuh_branch': None, 'working_dir': '/tmp/tests', 'live': True, 'hosts_ip': ['ec2-54-144-70-59.compute-1.amazonaws.com', '10.10.0.249'], 'targets': '{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}', 'dependencies': '{}', 'local_host_path': '/home/fcaffieri/repos/wazuh-qa/deployability', 'current_user': 'fcaffieri'}[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/setup.yml[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Cleaning old key ssh-keygen registries', 'ansible.builtin.command': {'cmd': "ssh-keygen -f /home/fcaffieri/.ssh/known_hosts -R ''"}, 'loop': ['ec2-54-144-70-59.compute-1.amazonaws.com', '10.10.0.249']}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Cleaning old key ssh-keygen registries] **********************************
[0;33mchanged: [localhost] => (item=ec2-54-144-70-59.compute-1.amazonaws.com) => changed=true [0m
[0;33m  ansible_loop_var: item[0m
[0;33m  cmd:[0m
[0;33m  - ssh-keygen[0m
[0;33m  - -f[0m
[0;33m  - /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  - -R[0m
[0;33m  - ''[0m
[0;33m  delta: '0:00:00.005746'[0m
[0;33m  end: '2024-05-20 18:20:36.066950'[0m
[0;33m  item: ec2-54-144-70-59.compute-1.amazonaws.com[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:20:36.061204'[0m
[0;33m  stderr: Host  not found in /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: ''[0m
[0;33m  stdout_lines: <omitted>[0m
[0;33mchanged: [localhost] => (item=10.10.0.249) => changed=true [0m
[0;33m  ansible_loop_var: item[0m
[0;33m  cmd:[0m
[0;33m  - ssh-keygen[0m
[0;33m  - -f[0m
[0;33m  - /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  - -R[0m
[0;33m  - ''[0m
[0;33m  delta: '0:00:00.005489'[0m
[0;33m  end: '2024-05-20 18:20:36.283322'[0m
[0;33m  item: 10.10.0.249[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:20:36.277833'[0m
[0;33m  stderr: Host  not found in /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: ''[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Cleaning old key ssh-keygen registries', 'ansible.builtin.command': {'cmd': "ssh-keygen -f /home/fcaffieri/.ssh/known_hosts -R ''"}, 'loop': ['ec2-54-144-70-59.compute-1.amazonaws.com', '10.10.0.249']}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/test.yml[0m
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test install for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_install.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Test install for agent] **************************************************
[0;33mchanged: [localhost] => changed=true [0m
[0;33m  cmd:[0m
[0;33m  - python3[0m
[0;33m  - -m[0m
[0;33m  - pytest[0m
[0;33m  - modules/testing/tests/test_agent/test_install.py[0m
[0;33m  - -v[0m
[0;33m  - --wazuh_version=4.7.4[0m
[0;33m  - --wazuh_revision=40717[0m
[0;33m  - --component=agent[0m
[0;33m  - --dependencies={}[0m
[0;33m  - '--targets={wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}'[0m
[0;33m  - --live=True[0m
[0;33m  - -s[0m
[0;33m  delta: '0:00:54.122628'[0m
[0;33m  end: '2024-05-20 18:21:33.448564'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:20:39.325936'[0m
[0;33m  stderr: |-[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    [37m[2024-05-20 18:20:39] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m[0m
[0;33m    [37m[2024-05-20 18:20:39] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m[0m
[0;33m    ============================= test session starts ==============================[0m
[0;33m    platform linux -- Python 3.10.14, pytest-7.4.4, pluggy-1.4.0 -- /home/fcaffieri/repos/wazuh-qa/.venv/bin/python3[0m
[0;33m    cachedir: .pytest_cache[0m
[0;33m    rootdir: /home/fcaffieri/repos/wazuh-qa/deployability/modules[0m
[0;33m    collecting ... collected 2 items[0m
[0;33m  [0m
[0;33m    modules/testing/tests/test_agent/test_install.py::test_installation [32m[2024-05-20 18:20:40] [INFO] TESTER: Checking connection to ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:20:44] [INFO] TESTER: Connection established successfully in ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:20:49] [INFO] TESTER: Checking connection to ubuntu-22.04[0m[0m
[0;33m    [32m[2024-05-20 18:20:50] [INFO] TESTER: Connection established successfully in ubuntu-22.04[0m[0m
[0;33m    [32m[2024-05-20 18:20:50] [INFO] TESTER: Firewall disabled on ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:20:58] [INFO] TESTER: Manager is already installed in ubuntu-22.04[0m[0m
[0;33m    [32m[2024-05-20 18:21:01] [INFO] TESTER: Installing Agent in ventura-13[0m[0m
[0;33m    PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_install.py::test_status [32m[2024-05-20 18:21:28] [INFO] TESTER: Getting status of ventura-13[0m[0m
[0;33m    PASSED[0m
[0;33m  [0m
[0;33m    =============================== warnings summary ===============================[0m
[0;33m    modules/provision/models.py:36[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:36: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('dependencies', pre=True)[0m
[0;33m  [0m
[0;33m    modules/provision/models.py:64[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:64: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('install', 'uninstall', pre=True)[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/generic.py:406[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/generic.py:406: DeprecationWarning: invalid escape sequence '\s'[0m
[0;33m        f"sed -i '/^\s*#/d' {current_directory}/config.yml"[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/generic.py:412[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/generic.py:412: DeprecationWarning: invalid escape sequence '\s'[0m
[0;33m        f"sed -i '/^\s*#/d' {current_directory}/config.yml"[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/generic.py:417[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/generic.py:417: DeprecationWarning: invalid escape sequence '\ '[0m
[0;33m        commands.append(f"""sed -i '/ip: "<wazuh-manager-ip>"/a\      node_type: master' {current_directory}/config.yml""")[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/generic.py:601[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/generic.py:601: DeprecationWarning: invalid escape sequence '\;'[0m
[0;33m        command = f'sudo find {directory} -type f -exec shasum -a 256 {{}} \; {filter}'[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/agent.py:72[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/agent.py:72: DeprecationWarning: invalid escape sequence '\w'[0m
[0;33m        "-OutFile $env:TEMP\wazuh-agent.msi"[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/agent.py:75[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/agent.py:75: DeprecationWarning: invalid escape sequence '\w'[0m
[0;33m        "msiexec.exe /i $env:TEMP\wazuh-agent.msi /q "[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/agent.py:125[0m
[0;33m    modules/testing/tests/helpers/agent.py:125[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/agent.py:125: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"sed -i 's/<address>MANAGER_IP<\/address>/<address>{host_ip}<\/address>/g' {WAZUH_CONF}",[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/agent.py:142[0m
[0;33m    modules/testing/tests/helpers/agent.py:142[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/agent.py:142: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"sed -i '.bak' 's/<address>MANAGER_IP<\/address>/<address>{host_ip}<\/address>/g' {WAZUH_MACOS_CONF}",[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/agent.py:172[0m
[0;33m    modules/testing/tests/helpers/agent.py:172[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/agent.py:172: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"sed -i 's/<protocol>[^<]*<\/protocol>/<protocol>{protocol}<\/protocol>/g' {WAZUH_CONF}",[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/agent.py:181[0m
[0;33m    modules/testing/tests/helpers/agent.py:181[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/agent.py:181: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"sed -i '' 's/<protocol>[^<]*<\/protocol>/<protocol>{protocol}<\/protocol>/g' {WAZUH_MACOS_CONF}",[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/agent.py:189[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/agent.py:189: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"(Get-Content -Path '{WAZUH_WINDOWS_CONF}') -replace '<protocol>[^<]*<\/protocol>', '<protocol>{protocol}</protocol>' | Set-Content -Path '{WAZUH_WINDOWS_CONF}'"[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/agent.py:227[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/agent.py:227: DeprecationWarning: invalid escape sequence '\w'[0m
[0;33m        f"msiexec.exe /x $env:TEMP\wazuh-agent.msi /qn"[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/manager.py:353[0m
[0;33m    modules/testing/tests/helpers/manager.py:353[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/manager.py:353: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"sed -i 's/<node_name>node01<\/node_name>/<node_name>{node_name}<\/node_name>/' {WAZUH_CONF}",[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/manager.py:354[0m
[0;33m    modules/testing/tests/helpers/manager.py:354[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/manager.py:354: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"sed -i 's/<node_type>master<\/node_type>/<node_type>{node_type}<\/node_type>/'  {WAZUH_CONF}",[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/manager.py:355[0m
[0;33m    modules/testing/tests/helpers/manager.py:355[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/manager.py:355: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"sed -i 's/<key><\/key>/<key>{key}<\/key>/' {WAZUH_CONF}",[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/manager.py:356[0m
[0;33m    modules/testing/tests/helpers/manager.py:356[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/manager.py:356: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"sed -i 's/<node>NODE_IP<\/node>/<node>{HostInformation.get_internal_ip_from_aws_dns(master_dns)}<\/node>/' {WAZUH_CONF}",[0m
[0;33m  [0m
[0;33m    modules/testing/tests/helpers/manager.py:357[0m
[0;33m    modules/testing/tests/helpers/manager.py:357[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/tests/helpers/manager.py:357: DeprecationWarning: invalid escape sequence '\/'[0m
[0;33m        f"sed -i 's/<disabled>yes<\/disabled>/<disabled>{disabled}<\/disabled>/' {WAZUH_CONF}",[0m
[0;33m  [0m
[0;33m    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html[0m
[0;33m    ======================= 2 passed, 28 warnings in 53.14s ========================[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:21:33] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test install for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_install.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[37m[2024-05-20 18:21:33] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/test.yml[0m
[37m[2024-05-20 18:21:33] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:21:33] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test registration for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_registration.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Test registration for agent] *********************************************
[0;33mchanged: [localhost] => changed=true [0m
[0;33m  cmd:[0m
[0;33m  - python3[0m
[0;33m  - -m[0m
[0;33m  - pytest[0m
[0;33m  - modules/testing/tests/test_agent/test_registration.py[0m
[0;33m  - -v[0m
[0;33m  - --wazuh_version=4.7.4[0m
[0;33m  - --wazuh_revision=40717[0m
[0;33m  - --component=agent[0m
[0;33m  - --dependencies={}[0m
[0;33m  - '--targets={wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}'[0m
[0;33m  - --live=True[0m
[0;33m  - -s[0m
[0;33m  delta: '0:01:22.305398'[0m
[0;33m  end: '2024-05-20 18:22:58.367417'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:21:36.062019'[0m
[0;33m  stderr: |-[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    [37m[2024-05-20 18:21:36] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m[0m
[0;33m    [37m[2024-05-20 18:21:36] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m[0m
[0;33m    ============================= test session starts ==============================[0m
[0;33m    platform linux -- Python 3.10.14, pytest-7.4.4, pluggy-1.4.0 -- /home/fcaffieri/repos/wazuh-qa/.venv/bin/python3[0m
[0;33m    cachedir: .pytest_cache[0m
[0;33m    rootdir: /home/fcaffieri/repos/wazuh-qa/deployability/modules[0m
[0;33m    collecting ... collected 4 items[0m
[0;33m  [0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_status [32m[2024-05-20 18:21:36] [INFO] TESTER: Checking connection to ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:21:41] [INFO] TESTER: Connection established successfully in ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:21:55] [INFO] TESTER: Registering agent in ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:22:19] [INFO] TESTER: Getting status of ventura-13[0m[0m
[0;33m    PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_service PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_connection PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_clientKeys PASSED[0m
[0;33m  [0m
[0;33m    =============================== warnings summary ===============================[0m
[0;33m    modules/provision/models.py:36[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:36: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('dependencies', pre=True)[0m
[0;33m  [0m
[0;33m    modules/provision/models.py:64[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:64: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('install', 'uninstall', pre=True)[0m
[0;33m  [0m
[0;33m    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html[0m
[0;33m    =================== 4 passed, 2 warnings in 81.43s (0:01:21) ===================[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:22:58] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test registration for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_registration.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[37m[2024-05-20 18:22:58] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/test.yml[0m
[37m[2024-05-20 18:22:58] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:22:58] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test basic_info for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_basic_info.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Test basic_info for agent] ***********************************************
[0;33mchanged: [localhost] => changed=true [0m
[0;33m  cmd:[0m
[0;33m  - python3[0m
[0;33m  - -m[0m
[0;33m  - pytest[0m
[0;33m  - modules/testing/tests/test_agent/test_basic_info.py[0m
[0;33m  - -v[0m
[0;33m  - --wazuh_version=4.7.4[0m
[0;33m  - --wazuh_revision=40717[0m
[0;33m  - --component=agent[0m
[0;33m  - --dependencies={}[0m
[0;33m  - '--targets={wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}'[0m
[0;33m  - --live=True[0m
[0;33m  - -s[0m
[0;33m  delta: '0:00:56.721239'[0m
[0;33m  end: '2024-05-20 18:23:57.957751'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:23:01.236512'[0m
[0;33m  stderr: |-[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    [37m[2024-05-20 18:23:01] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m[0m
[0;33m    [37m[2024-05-20 18:23:01] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m[0m
[0;33m    ============================= test session starts ==============================[0m
[0;33m    platform linux -- Python 3.10.14, pytest-7.4.4, pluggy-1.4.0 -- /home/fcaffieri/repos/wazuh-qa/.venv/bin/python3[0m
[0;33m    cachedir: .pytest_cache[0m
[0;33m    rootdir: /home/fcaffieri/repos/wazuh-qa/deployability/modules[0m
[0;33m    collecting ... collected 3 items[0m
[0;33m  [0m
[0;33m    modules/testing/tests/test_agent/test_basic_info.py::test_wazuh_os_version [32m[2024-05-20 18:23:02] [INFO] TESTER: Checking connection to ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:23:06] [INFO] TESTER: Connection established successfully in ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:23:47] [INFO] TESTER: Version obtained from agent: 13.6.6[0m[0m
[0;33m    [32m[2024-05-20 18:23:47] [INFO] TESTER: Version obtained from Wazuh API: 13.6.6[0m[0m
[0;33m    PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_basic_info.py::test_wazuh_version PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_basic_info.py::test_wazuh_revision PASSED[0m
[0;33m  [0m
[0;33m    =============================== warnings summary ===============================[0m
[0;33m    modules/provision/models.py:36[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:36: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('dependencies', pre=True)[0m
[0;33m  [0m
[0;33m    modules/provision/models.py:64[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:64: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('install', 'uninstall', pre=True)[0m
[0;33m  [0m
[0;33m    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html[0m
[0;33m    ======================== 3 passed, 2 warnings in 55.84s ========================[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:23:58] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test basic_info for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_basic_info.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-amd64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[32m[2024-05-20 18:23:58] [INFO] TESTER: Cleaning up[0m
[37m[2024-05-20 18:23:58] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:23:58] [DEBUG] TESTER: Running playbook: /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml[0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [all] *********************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com][0m

TASK [Clean test directory] ****************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=false [0m
[0;32m  path: /tmp/tests[0m
[0;32m  state: absent[0m

PLAY RECAP *********************************************************************
[0;32mec2-54-144-70-59.compute-1.amazonaws.com[0m : [0;32mok=2   [0m changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:24:11] [DEBUG] TESTER: Playbook /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml finished with status {'skipped': {}, 'ok': {'ec2-54-144-70-59.compute-1.amazonaws.com': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 1}, 'changed': {}}[0m
[32m[2024-05-20 18:24:11] [INFO] TESTER: Cleaning up[0m
[37m[2024-05-20 18:24:11] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:24:11] [DEBUG] TESTER: Running playbook: /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml[0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [all] *********************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com][0m

TASK [Clean test directory] ****************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=false [0m
[0;32m  path: /tmp/tests[0m
[0;32m  state: absent[0m

PLAY RECAP *********************************************************************
[0;32mec2-54-144-70-59.compute-1.amazonaws.com[0m : [0;32mok=2   [0m changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:24:21] [DEBUG] TESTER: Playbook /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml finished with status {'skipped': {}, 'ok': {'ec2-54-144-70-59.compute-1.amazonaws.com': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 1}, 'changed': {}}[0m
[0m
[32m[2024-05-20 18:24:21] [INFO] [486264] [ThreadPoolExecutor-0_3] [workflow_engine]: [run-agent-macos-ventura-13-amd64-tests] Finished task in 228.86 seconds.[0m
[36m[2024-05-20 18:24:23] [DEBUG] [486264] [ThreadPoolExecutor-0_1] [workflow_engine]: Finished task "run-agent-macos-ventura-13-arm64-tests" execution with result:
[37m[2024-05-20 18:20:33] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:20:33] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:20:33] [INFO] TESTER: Running tests for ec2-54-144-70-59.compute-1.amazonaws.com[0m
[32m[2024-05-20 18:20:33] [INFO] TESTER: Running tests for 10.10.0.250[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Using extra vars: {'component': 'agent', 'wazuh_version': '4.7.4', 'wazuh_revision': '40717', 'wazuh_branch': None, 'working_dir': '/tmp/tests', 'live': True, 'hosts_ip': ['ec2-54-144-70-59.compute-1.amazonaws.com', '10.10.0.250'], 'targets': '{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}', 'dependencies': '{}', 'local_host_path': '/home/fcaffieri/repos/wazuh-qa/deployability', 'current_user': 'fcaffieri'}[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/setup.yml[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:20:33] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Cleaning old key ssh-keygen registries', 'ansible.builtin.command': {'cmd': "ssh-keygen -f /home/fcaffieri/.ssh/known_hosts -R ''"}, 'loop': ['ec2-54-144-70-59.compute-1.amazonaws.com', '10.10.0.250']}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Cleaning old key ssh-keygen registries] **********************************
[0;33mchanged: [localhost] => (item=ec2-54-144-70-59.compute-1.amazonaws.com) => changed=true [0m
[0;33m  ansible_loop_var: item[0m
[0;33m  cmd:[0m
[0;33m  - ssh-keygen[0m
[0;33m  - -f[0m
[0;33m  - /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  - -R[0m
[0;33m  - ''[0m
[0;33m  delta: '0:00:00.005471'[0m
[0;33m  end: '2024-05-20 18:20:36.139850'[0m
[0;33m  item: ec2-54-144-70-59.compute-1.amazonaws.com[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:20:36.134379'[0m
[0;33m  stderr: Host  not found in /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: ''[0m
[0;33m  stdout_lines: <omitted>[0m
[0;33mchanged: [localhost] => (item=10.10.0.250) => changed=true [0m
[0;33m  ansible_loop_var: item[0m
[0;33m  cmd:[0m
[0;33m  - ssh-keygen[0m
[0;33m  - -f[0m
[0;33m  - /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  - -R[0m
[0;33m  - ''[0m
[0;33m  delta: '0:00:00.005582'[0m
[0;33m  end: '2024-05-20 18:20:36.363270'[0m
[0;33m  item: 10.10.0.250[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:20:36.357688'[0m
[0;33m  stderr: Host  not found in /home/fcaffieri/.ssh/known_hosts[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: ''[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Cleaning old key ssh-keygen registries', 'ansible.builtin.command': {'cmd': "ssh-keygen -f /home/fcaffieri/.ssh/known_hosts -R ''"}, 'loop': ['ec2-54-144-70-59.compute-1.amazonaws.com', '10.10.0.250']}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/test.yml[0m
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:20:36] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test install for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_install.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Test install for agent] **************************************************
[0;33mchanged: [localhost] => changed=true [0m
[0;33m  cmd:[0m
[0;33m  - python3[0m
[0;33m  - -m[0m
[0;33m  - pytest[0m
[0;33m  - modules/testing/tests/test_agent/test_install.py[0m
[0;33m  - -v[0m
[0;33m  - --wazuh_version=4.7.4[0m
[0;33m  - --wazuh_revision=40717[0m
[0;33m  - --component=agent[0m
[0;33m  - --dependencies={}[0m
[0;33m  - '--targets={wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}'[0m
[0;33m  - --live=True[0m
[0;33m  - -s[0m
[0;33m  delta: '0:00:51.893566'[0m
[0;33m  end: '2024-05-20 18:21:31.286397'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:20:39.392831'[0m
[0;33m  stderr: |-[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    [37m[2024-05-20 18:20:40] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m[0m
[0;33m    [37m[2024-05-20 18:20:40] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m[0m
[0;33m    ============================= test session starts ==============================[0m
[0;33m    platform linux -- Python 3.10.14, pytest-7.4.4, pluggy-1.4.0 -- /home/fcaffieri/repos/wazuh-qa/.venv/bin/python3[0m
[0;33m    cachedir: .pytest_cache[0m
[0;33m    rootdir: /home/fcaffieri/repos/wazuh-qa/deployability/modules[0m
[0;33m    collecting ... collected 2 items[0m
[0;33m  [0m
[0;33m    modules/testing/tests/test_agent/test_install.py::test_installation [32m[2024-05-20 18:20:40] [INFO] TESTER: Checking connection to ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:20:44] [INFO] TESTER: Connection established successfully in ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:20:49] [INFO] TESTER: Checking connection to ubuntu-22.04[0m[0m
[0;33m    [32m[2024-05-20 18:20:50] [INFO] TESTER: Connection established successfully in ubuntu-22.04[0m[0m
[0;33m    [32m[2024-05-20 18:20:50] [INFO] TESTER: Firewall disabled on ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:20:58] [INFO] TESTER: Manager is already installed in ubuntu-22.04[0m[0m
[0;33m    [32m[2024-05-20 18:21:01] [INFO] TESTER: Installing Agent in ventura-13[0m[0m
[0;33m    PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_install.py::test_status [32m[2024-05-20 18:21:26] [INFO] TESTER: Getting status of ventura-13[0m[0m
[0;33m    PASSED[0m
[0;33m  [0m
[0;33m    =============================== warnings summary ===============================[0m
[0;33m    modules/provision/models.py:36[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:36: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('dependencies', pre=True)[0m
[0;33m  [0m
[0;33m    modules/provision/models.py:64[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:64: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('install', 'uninstall', pre=True)[0m
[0;33m  [0m
[0;33m    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html[0m
[0;33m    ======================== 2 passed, 2 warnings in 50.92s ========================[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:21:31] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test install for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_install.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[37m[2024-05-20 18:21:31] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/test.yml[0m
[37m[2024-05-20 18:21:31] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:21:31] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test registration for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_registration.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Test registration for agent] *********************************************
[0;33mchanged: [localhost] => changed=true [0m
[0;33m  cmd:[0m
[0;33m  - python3[0m
[0;33m  - -m[0m
[0;33m  - pytest[0m
[0;33m  - modules/testing/tests/test_agent/test_registration.py[0m
[0;33m  - -v[0m
[0;33m  - --wazuh_version=4.7.4[0m
[0;33m  - --wazuh_revision=40717[0m
[0;33m  - --component=agent[0m
[0;33m  - --dependencies={}[0m
[0;33m  - '--targets={wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}'[0m
[0;33m  - --live=True[0m
[0;33m  - -s[0m
[0;33m  delta: '0:01:21.782904'[0m
[0;33m  end: '2024-05-20 18:22:55.412542'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:21:33.629638'[0m
[0;33m  stderr: |-[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    [37m[2024-05-20 18:21:34] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m[0m
[0;33m    [37m[2024-05-20 18:21:34] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m[0m
[0;33m    ============================= test session starts ==============================[0m
[0;33m    platform linux -- Python 3.10.14, pytest-7.4.4, pluggy-1.4.0 -- /home/fcaffieri/repos/wazuh-qa/.venv/bin/python3[0m
[0;33m    cachedir: .pytest_cache[0m
[0;33m    rootdir: /home/fcaffieri/repos/wazuh-qa/deployability/modules[0m
[0;33m    collecting ... collected 4 items[0m
[0;33m  [0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_status [32m[2024-05-20 18:21:34] [INFO] TESTER: Checking connection to ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:21:38] [INFO] TESTER: Connection established successfully in ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:21:53] [INFO] TESTER: Registering agent in ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:22:17] [INFO] TESTER: Getting status of ventura-13[0m[0m
[0;33m    PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_service PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_connection PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_registration.py::test_clientKeys PASSED[0m
[0;33m  [0m
[0;33m    =============================== warnings summary ===============================[0m
[0;33m    modules/provision/models.py:36[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:36: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('dependencies', pre=True)[0m
[0;33m  [0m
[0;33m    modules/provision/models.py:64[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:64: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('install', 'uninstall', pre=True)[0m
[0;33m  [0m
[0;33m    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html[0m
[0;33m    =================== 4 passed, 2 warnings in 80.90s (0:01:20) ===================[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:22:55] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test registration for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_registration.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[37m[2024-05-20 18:22:55] [DEBUG] TESTER: Rendering template /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/test.yml[0m
[37m[2024-05-20 18:22:55] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:22:55] [DEBUG] TESTER: Running playbook: [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test basic_info for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_basic_info.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}][0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [localhost] ***************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [localhost][0m

TASK [Test basic_info for agent] ***********************************************
[0;33mchanged: [localhost] => changed=true [0m
[0;33m  cmd:[0m
[0;33m  - python3[0m
[0;33m  - -m[0m
[0;33m  - pytest[0m
[0;33m  - modules/testing/tests/test_agent/test_basic_info.py[0m
[0;33m  - -v[0m
[0;33m  - --wazuh_version=4.7.4[0m
[0;33m  - --wazuh_revision=40717[0m
[0;33m  - --component=agent[0m
[0;33m  - --dependencies={}[0m
[0;33m  - '--targets={wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}'[0m
[0;33m  - --live=True[0m
[0;33m  - -s[0m
[0;33m  delta: '0:01:04.969172'[0m
[0;33m  end: '2024-05-20 18:24:02.641926'[0m
[0;33m  msg: ''[0m
[0;33m  rc: 0[0m
[0;33m  start: '2024-05-20 18:22:57.672754'[0m
[0;33m  stderr: |-[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m    Warning: Permanently added '[ec2-54-144-70-59.compute-1.amazonaws.com]:2200,[54.144.70.59]:2200' (ECDSA) to the list of known hosts.[0m
[0;33m  stderr_lines: <omitted>[0m
[0;33m  stdout: |-[0m
[0;33m    [37m[2024-05-20 18:22:58] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m[0m
[0;33m    [37m[2024-05-20 18:22:58] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m[0m
[0;33m    ============================= test session starts ==============================[0m
[0;33m    platform linux -- Python 3.10.14, pytest-7.4.4, pluggy-1.4.0 -- /home/fcaffieri/repos/wazuh-qa/.venv/bin/python3[0m
[0;33m    cachedir: .pytest_cache[0m
[0;33m    rootdir: /home/fcaffieri/repos/wazuh-qa/deployability/modules[0m
[0;33m    collecting ... collected 3 items[0m
[0;33m  [0m
[0;33m    modules/testing/tests/test_agent/test_basic_info.py::test_wazuh_os_version [32m[2024-05-20 18:22:58] [INFO] TESTER: Checking connection to ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:23:12] [INFO] TESTER: Connection established successfully in ventura-13[0m[0m
[0;33m    [32m[2024-05-20 18:23:52] [INFO] TESTER: Version obtained from agent: 13.4.1[0m[0m
[0;33m    [32m[2024-05-20 18:23:52] [INFO] TESTER: Version obtained from Wazuh API: 13.4.1[0m[0m
[0;33m    PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_basic_info.py::test_wazuh_version PASSED[0m
[0;33m    modules/testing/tests/test_agent/test_basic_info.py::test_wazuh_revision PASSED[0m
[0;33m  [0m
[0;33m    =============================== warnings summary ===============================[0m
[0;33m    modules/provision/models.py:36[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:36: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('dependencies', pre=True)[0m
[0;33m  [0m
[0;33m    modules/provision/models.py:64[0m
[0;33m      /home/fcaffieri/repos/wazuh-qa/deployability/modules/provision/models.py:64: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/[0m
[0;33m        @validator('install', 'uninstall', pre=True)[0m
[0;33m  [0m
[0;33m    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html[0m
[0;33m    =================== 3 passed, 2 warnings in 64.17s (0:01:04) ===================[0m
[0;33m  stdout_lines: <omitted>[0m

PLAY RECAP *********************************************************************
[0;33mlocalhost[0m                  : [0;32mok=2   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:24:02] [DEBUG] TESTER: Playbook [{'hosts': 'localhost', 'become': True, 'become_user': 'fcaffieri', 'tasks': [{'name': 'Test basic_info for agent', 'command': "python3 -m pytest modules/testing/tests/test_agent/test_basic_info.py  -v --wazuh_version=4.7.4 --wazuh_revision=40717  --component=agent --dependencies='{}' --targets='{wazuh-1: /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/inventory.yaml, agent: /tmp/dtt1-poc/agent-macos-ventura-13-arm64/inventory.yaml}' --live=True -s", 'args': {'chdir': '/home/fcaffieri/repos/wazuh-qa/deployability'}}]}] finished with status {'skipped': {}, 'ok': {'localhost': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'localhost': 1}, 'changed': {'localhost': 1}}[0m
[32m[2024-05-20 18:24:02] [INFO] TESTER: Cleaning up[0m
[37m[2024-05-20 18:24:02] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:24:02] [DEBUG] TESTER: Running playbook: /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml[0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [all] *********************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com][0m

TASK [Clean test directory] ****************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=false [0m
[0;32m  path: /tmp/tests[0m
[0;32m  state: absent[0m

PLAY RECAP *********************************************************************
[0;32mec2-54-144-70-59.compute-1.amazonaws.com[0m : [0;32mok=2   [0m changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:24:13] [DEBUG] TESTER: Playbook /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml finished with status {'skipped': {}, 'ok': {'ec2-54-144-70-59.compute-1.amazonaws.com': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 1}, 'changed': {}}[0m
[32m[2024-05-20 18:24:13] [INFO] TESTER: Cleaning up[0m
[37m[2024-05-20 18:24:13] [DEBUG] TESTER: Using inventory: {'all': {'hosts': {'ec2-54-144-70-59.compute-1.amazonaws.com': {'ansible_port': 2200, 'ansible_user': 'ubuntu', 'ansible_ssh_private_key_file': '/tmp/wazuh-qa/i-0e4256e5c7bc34023/qa-5191-ubuntu-22.04-key-3891'}}}}[0m
[37m[2024-05-20 18:24:13] [DEBUG] TESTER: Running playbook: /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml[0m
[0;34mUsing /etc/ansible/ansible.cfg as config file[0m

PLAY [all] *********************************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com][0m

TASK [Clean test directory] ****************************************************
[0;32mok: [ec2-54-144-70-59.compute-1.amazonaws.com] => changed=false [0m
[0;32m  path: /tmp/tests[0m
[0;32m  state: absent[0m

PLAY RECAP *********************************************************************
[0;32mec2-54-144-70-59.compute-1.amazonaws.com[0m : [0;32mok=2   [0m changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[37m[2024-05-20 18:24:23] [DEBUG] TESTER: Playbook /home/fcaffieri/repos/wazuh-qa/deployability/modules/testing/playbooks/cleanup.yml finished with status {'skipped': {}, 'ok': {'ec2-54-144-70-59.compute-1.amazonaws.com': 2}, 'dark': {}, 'failures': {}, 'ignored': {}, 'rescued': {}, 'processed': {'ec2-54-144-70-59.compute-1.amazonaws.com': 1}, 'changed': {}}[0m
[0m
[32m[2024-05-20 18:24:23] [INFO] [486264] [ThreadPoolExecutor-0_1] [workflow_engine]: [run-agent-macos-ventura-13-arm64-tests] Finished task in 230.94 seconds.[0m
[32m[2024-05-20 18:24:23] [INFO] [486264] [MainThread] [workflow_engine]: Executing Reverse DAG tasks.[0m
[32m[2024-05-20 18:24:23] [INFO] [486264] [MainThread] [workflow_engine]: Executing tasks in parallel.[0m
[32m[2024-05-20 18:24:23] [INFO] [486264] [ThreadPoolExecutor-1_0] [workflow_engine]: [allocate-macos-agent-macos-ventura-13-amd64] Starting task.[0m
[36m[2024-05-20 18:24:23] [DEBUG] [486264] [ThreadPoolExecutor-1_0] [workflow_engine]: Running task "allocate-macos-agent-macos-ventura-13-amd64" with arguments: ['modules/allocation/main.py', '--action=delete', '--track-output=/tmp/dtt1-poc/agent-macos-ventura-13-amd64/track.yaml'][0m
[32m[2024-05-20 18:24:23] [INFO] [486264] [ThreadPoolExecutor-1_1] [workflow_engine]: [allocate-macos-agent-macos-ventura-13-arm64] Starting task.[0m
[32m[2024-05-20 18:24:23] [INFO] [486264] [ThreadPoolExecutor-1_2] [workflow_engine]: [allocate-macos-agent-macos-sonoma-14-amd64] Starting task.[0m
[36m[2024-05-20 18:24:23] [DEBUG] [486264] [ThreadPoolExecutor-1_1] [workflow_engine]: Running task "allocate-macos-agent-macos-ventura-13-arm64" with arguments: ['modules/allocation/main.py', '--action=delete', '--track-output=/tmp/dtt1-poc/agent-macos-ventura-13-arm64/track.yaml'][0m
[32m[2024-05-20 18:24:23] [INFO] [486264] [ThreadPoolExecutor-1_3] [workflow_engine]: [allocate-macos-agent-macos-sonoma-14-arm64] Starting task.[0m
[32m[2024-05-20 18:24:23] [INFO] [486264] [ThreadPoolExecutor-1_4] [workflow_engine]: [allocate-manager-linux-ubuntu-22.04-amd64] Starting task.[0m
[36m[2024-05-20 18:24:23] [DEBUG] [486264] [ThreadPoolExecutor-1_2] [workflow_engine]: Running task "allocate-macos-agent-macos-sonoma-14-amd64" with arguments: ['modules/allocation/main.py', '--action=delete', '--track-output=/tmp/dtt1-poc/agent-macos-sonoma-14-amd64/track.yaml'][0m
[36m[2024-05-20 18:24:23] [DEBUG] [486264] [ThreadPoolExecutor-1_3] [workflow_engine]: Running task "allocate-macos-agent-macos-sonoma-14-arm64" with arguments: ['modules/allocation/main.py', '--action=delete', '--track-output=/tmp/dtt1-poc/agent-macos-sonoma-14-arm64/track.yaml'][0m
[36m[2024-05-20 18:24:23] [DEBUG] [486264] [ThreadPoolExecutor-1_4] [workflow_engine]: Running task "allocate-manager-linux-ubuntu-22.04-amd64" with arguments: ['modules/allocation/main.py', '--action=delete', '--track-output=/tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/track.yaml'][0m
[31m[2024-05-20 18:24:24] [ERROR] [486264] [ThreadPoolExecutor-1_3] [workflow_engine]: [allocate-macos-agent-macos-sonoma-14-arm64] Task failed with error: Error executing process task Traceback (most recent call last):
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/main.py", line 39, in <module>
    main()
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/main.py", line 35, in main
    Allocator.run(InputPayload(**vars(parse_arguments())))
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/allocation.py", line 43, in run
    return cls.__delete(payload)
  File "/home/fcaffieri/repos/wazuh-qa/deployability/modules/allocation/allocation.py", line 93, in __delete
    with open(payload.track_output, 'r') as f:
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/dtt1-poc/agent-macos-sonoma-14-arm64/track.yaml'
.[0m
[36m[2024-05-20 18:24:59] [DEBUG] [486264] [ThreadPoolExecutor-1_1] [workflow_engine]: Finished task "allocate-macos-agent-macos-ventura-13-arm64" execution with result:
[37m[2024-05-20 18:24:24] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:24:24] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:24:24] [INFO] ALLOCATOR: Deleting instance from trackfile /tmp/dtt1-poc/agent-macos-ventura-13-arm64/track.yaml[0m
[37m[2024-05-20 18:24:25] [DEBUG] ALLOCATOR: Destroying instance qa-5191-ventura-13-2119[0m
[37m[2024-05-20 18:24:42] [DEBUG] ALLOCATOR: Deleting remote directory /Users/jenkins/testing/qa-5191-ventura-13-2119[0m
[37m[2024-05-20 18:24:48] [DEBUG] ALLOCATOR: Killing remote process on port 43222[0m
[32m[2024-05-20 18:24:59] [INFO] ALLOCATOR: Instance qa-5191-ventura-13-2119 deleted.[0m
[0m
[32m[2024-05-20 18:24:59] [INFO] [486264] [ThreadPoolExecutor-1_1] [workflow_engine]: [allocate-macos-agent-macos-ventura-13-arm64] Finished task in 36.48 seconds.[0m
[36m[2024-05-20 18:25:06] [DEBUG] [486264] [ThreadPoolExecutor-1_0] [workflow_engine]: Finished task "allocate-macos-agent-macos-ventura-13-amd64" execution with result:
[37m[2024-05-20 18:24:23] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:24:23] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:24:23] [INFO] ALLOCATOR: Deleting instance from trackfile /tmp/dtt1-poc/agent-macos-ventura-13-amd64/track.yaml[0m
[37m[2024-05-20 18:24:25] [DEBUG] ALLOCATOR: Destroying instance qa-5191-ventura-13-3162[0m
[37m[2024-05-20 18:24:48] [DEBUG] ALLOCATOR: Deleting remote directory /Users/jenkins/testing/qa-5191-ventura-13-3162[0m
[37m[2024-05-20 18:24:54] [DEBUG] ALLOCATOR: Killing remote process on port 43230[0m
[32m[2024-05-20 18:25:06] [INFO] ALLOCATOR: Instance qa-5191-ventura-13-3162 deleted.[0m
[0m
[32m[2024-05-20 18:25:06] [INFO] [486264] [ThreadPoolExecutor-1_0] [workflow_engine]: [allocate-macos-agent-macos-ventura-13-amd64] Finished task in 42.92 seconds.[0m
[36m[2024-05-20 18:25:06] [DEBUG] [486264] [ThreadPoolExecutor-1_2] [workflow_engine]: Finished task "allocate-macos-agent-macos-sonoma-14-amd64" execution with result:
[37m[2024-05-20 18:24:23] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:24:23] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:24:24] [INFO] ALLOCATOR: Deleting instance from trackfile /tmp/dtt1-poc/agent-macos-sonoma-14-amd64/track.yaml[0m
[37m[2024-05-20 18:24:25] [DEBUG] ALLOCATOR: Destroying instance qa-5191-sonoma-14-9588[0m
[37m[2024-05-20 18:24:48] [DEBUG] ALLOCATOR: Deleting remote directory /Users/jenkins/testing/qa-5191-sonoma-14-9588[0m
[37m[2024-05-20 18:24:54] [DEBUG] ALLOCATOR: Killing remote process on port 43239[0m
[32m[2024-05-20 18:25:06] [INFO] ALLOCATOR: Instance qa-5191-sonoma-14-9588 deleted.[0m
[0m
[32m[2024-05-20 18:25:06] [INFO] [486264] [ThreadPoolExecutor-1_2] [workflow_engine]: [allocate-macos-agent-macos-sonoma-14-amd64] Finished task in 42.95 seconds.[0m
[36m[2024-05-20 18:25:28] [DEBUG] [486264] [ThreadPoolExecutor-1_4] [workflow_engine]: Finished task "allocate-manager-linux-ubuntu-22.04-amd64" execution with result:
[37m[2024-05-20 18:24:24] [DEBUG] SPNEGO._GSS: Python gssapi not available, cannot use any GSSAPIProxy protocols: No module named 'gssapi'[0m
[37m[2024-05-20 18:24:24] [DEBUG] SPNEGO._GSS: Python gssapi IOV extension not available: No module named 'gssapi'[0m
[32m[2024-05-20 18:24:24] [INFO] ALLOCATOR: Deleting instance from trackfile /tmp/dtt1-poc/manager-linux-ubuntu-22.04-amd64/track.yaml[0m
[37m[2024-05-20 18:24:25] [DEBUG] ALLOCATOR: Deleting credentials: qa-5191-ubuntu-22.04-key-3891[0m
[32m[2024-05-20 18:25:27] [INFO] ALLOCATOR: Instance i-0e4256e5c7bc34023 deleted.[0m
[0m
[32m[2024-05-20 18:25:28] [INFO] [486264] [ThreadPoolExecutor-1_4] [workflow_engine]: [allocate-manager-linux-ubuntu-22.04-amd64] Finished task in 64.69 seconds.[0m
