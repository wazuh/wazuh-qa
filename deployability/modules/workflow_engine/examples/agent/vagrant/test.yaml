version: 0.1
description: Test agent restart with provisioning agents' with provision module
variables:
  agent-os:
    -  macos-ventura-13.4.1-arm64
  manager-os: linux-ubuntu-18.04-amd64
  infra-provider: aws
  working-dir: /tmp/dtt1-poc

tasks:



  # Generic agent test task
  - task: "run-agent-{agent}-tests"
    description: "Run tests install for the agent {agent}."
    do:
      this: process
      with:
        path: python3
        args:
          - modules/testing/main.py
          - targets:
            - wazuh-1: "{working-dir}/manager-{manager-os}/inventory.yaml"
            - agent: "{working-dir}/agent-{agent}/inventory.yaml"
          - tests: "install,registration,restart,stop,uninstall"
          - component: "agent"
          - wazuh-version: "4.7.3"
          - wazuh-revision: "40714"
          - live: "True"
    foreach:
      - variable: agent-os
        as: agent

