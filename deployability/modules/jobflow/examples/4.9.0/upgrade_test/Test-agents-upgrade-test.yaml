version: 0.1
description: This workflow is used to test agents deployment for DDT1 PoC
variables:
  #agent-os:
  #  - linux-redhat-9-amd64
  #  - linux-ubuntu-22.04-amd64

  macos-agent-os:
    - macos-sonoma-14-amd64

  #manager-os: linux-ubuntu-22.04-amd64
  infra-provider: aws
  macos-infra-provider: vagrant
  working-dir: /tmp/dtt1-poc

tasks:


  # Unique agent allocate task
  - task: "allocate-macos-agent-{agent}"
    description: "Allocate resources for the agent."
    do:
      this: process
      with:
        path: python3
        args:
          - modules/allocation/main.py
          - action: create
          - provider: "{macos-infra-provider}"
          - size: small
          - composite-name: "{agent}"
          - inventory-output: "{working-dir}/agent-{agent}/inventory.yaml"
          - track-output: "{working-dir}/agent-{agent}/track.yaml"
          - label-termination-date: "1d"
          - label-team: "qa"
          - label-issue: "https://github.com/wazuh/wazuh-qa/issues/5722"
    foreach:
      - variable: macos-agent-os
        as: agent

