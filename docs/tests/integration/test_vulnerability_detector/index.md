# Overview

Wazuh is able to detect vulnerabilities in the applications installed in agents using the `Vulnerability Detector`
module. This software audit is performed through the integration of vulnerability feeds indexed by `Canonical`,
`Debian`, `RedHat`, `Amazon Linux` and the `National Vulnerability Database`.

This directory includes all the integration tests developed to test the correct functioning of this module.

These tests can be classified in these categories:

- **[test_feeds](test_feeds/#test-feeds)**: Tests that check the behavior of Vulnerability Detector when a feed with an
unexpected content/type is imported, check feeds downloads, etc.

- **[test_general_settings](test_general_settings/#test-general-settings)**: Tests that check basic configuration of the
Vulnerability Detector in the configuration file.

- **[test_providers](test_providers/#test-providers)**: Tests that check the providers' configuration in the configuration file.

- **[test_scan_results](test_scan_results/#test-scan-results)** Tests that check if Vulnerability Detector generates
alerts in the right cases.

- **[test_scan_types](test_scan_types#test-scan-types)** Tests that check if the scan types of the
Vulnerability Detector are working as expected.

We can specify the set of tests that we want to launch, either individually, module, package or custom. Normally,
the tests are selected in a personalized way called **tier**.

A `tier` is a grouping of tests that follows some logic. Normally this logic is as follows:

- **tier 0** : Tests that test basic functionality and are of short duration.
- **tier 1** : Test that tests the main functionalities and is of medium duration.
- **tier 2** : Tests that test specific functionalities in detail They are usually of long duration.
- **...**

The following section shows the classification of tests in the different tiers.

## Tiers

### Tier 0

#### Test general settings

- **[test_general_settings_enabled](test_general_settings/test_general_settings_enabled.md#test-general-settings-enabled)**:
Tests that modify the value of `enabled` tag in the configuration file and check the result in the logs file.

- **[test_general_settings_min_full_scan_interval](test_general_settings/test_general_settings_min_full_scan_interval.md#test-general-settings-min-full-scan-interval)**:
Tests that modify the value of `min_full_scan_interval` tag in the configuration file, set different intervals, and checking the result in
the logs file.

- **[test_general_settings_interval](test_general_settings/test_general_settings_interval.md#test-general-settings-interval)**:
Tests that modify the value of `interval` tag in the configuration file, set different times and check the result in the logs file.

- **[test_general_settings_run_on_start](test_general_settings/test_general_settings_run_on_start.md#test-general-settings-run-on-start)**:
Tests that modify the value of `run_on_start` tag in the configuration file and check the result in the logs file.

#### Test scan results

- **[test_alert_vulnerability_removal](test_scan_results/test_alert_vulnerability_removal.md#test-alert-vulnerability-removal)**:
Test that adds a simulated agent to the system with two test packages containing vulnerabilities then starts 
a `BASELINE` scan and, after finishing it, removes the first package and updates the second one to a non-vulnerable 
version. It then launches a `PARTIAL_SCAN` and checks if alerts have been generated for these package operations.

- **[test_debian_inventory_debian_feed](test_scan_results/test_debian_inventory_debian_feed.md#test-debian-inventory-debian-feed)**:
Tests that mock Debian systems and insert custom vulnerabilities and vulnerable packages to check if Vulnerability
Detector generates the alerts from Debian provider feed.

- **[test_redhat_inventory_redhat_feed](test_scan_results/test_redhat_inventory_redhat_feed.md#test-red-hat-inventory-red-hat-feed)**:
Tests that mock RedHat systems and insert custom vulnerabilities and vulnerable packages to check if Vulnerability
Detector generates the alerts from RedHat provider feed.

- **[test_ubuntu_inventory_canonical_feed](test_scan_results/test_ubuntu_inventory_canonical_feed.md#test-ubuntu-inventory-canonical-feed)**:
Tests that mock Ubuntu systems and insert custom vulnerabilities and vulnerable packages to check if Vulnerability
Detector generates the alerts from Canonical provider feed.

- **[test_scan_nvd_feed](test_scan_results/test_scan_nvd_feed.md#test-scan-nvd-feed)**: Tests that mock RedHat,
Ubuntu, Debian, and Windows systems, and insert custom vulnerabilities and vulnerable packages to check if Vulnerability
Detector generates the alerts from NVD feed.

- **[test_scan_providers_and_nvd_feed](test_scan_results/test_scan_providers_and_nvd_feed.md#test-scan-providers-and-nvd-feed)**:
Tests mock RedHat, Ubuntu and Debian systems, and insert custom vulnerabilities and vulnerable packages to see if
Vulnerability Detector generates the alerts from NVD and providers feed.

- **[test_alas_inventory_alas_feed](test_scan_results/test_alas_inventory_alas_feed.md#test-amazon-linux-inventory-alas-feed)**:
Tests that mock Amazon Linux systems and insert custom vulnerabilities and vulnerable packages to check if Vulnerability
Detector generates alerts from ALAS provider feed.
#### Test scan types

- **[test_baseline_scan_type](test_scan_types/test_baseline_scan_type.md#test-baseline-scan-type)**:
Test that launches a `BASELINE` scan on a simulated agent containing a test package. It is confirmed through
the logs that the vulnerability for the test package is detected and no alert is generated for this vulnerability.

- **[test_partial_scan_type](test_scan_types/test_partial_scan_type.md#test-partial-scan-type)**:
Test that adds a simulated agent to the system with a test package containing a vulnerability then starts
a `BASELINE` scan and, after finishing it, adds a new test package with another vulnerability.
It then launches a `PARTIAL_SCAN` and checks that the alert has only been generated for the last package installed.

- **[test_full_scan_type](test_scan_types/test_full_scan_type.md#test-full-scan-type)**:
Test that adds a simulated agent to the system with two test packages containing vulnerabilities then starts
a `BASELINE` scan and, after finishing it, adds a new test package with another vulnerability and updates
the second package to a non-vulnerable version. It then launches a `FULL_SCAN` and checks that alerts
have been generated for both the installed package and the updated package, the latter due to the removal
of the vulnerability associated with it.

---

### Tier 1

#### Test feeds

- **[test_download_feeds](test_feeds/test_download_feed.md)**: The tests download
the different feeds (Redhat, Canonical, Debian, and NVD), import them, and check if the confirmation message appears
in the logs file.
- **[test_invalid_type_custom_feeds](test_feeds/test_invalid_type_custom_feeds.md#test-invalid-type-custom-feeds)**:
Tests that  import files of several different types (`.mp3`, `.jpg`, `.pdf` ...) as custom feed, and check the response
of Vulnerability Detector.
- **[test_invalid_type_url_feeds](test_feeds/test_invalid_type_url_feeds.md)**: The tests check that when importing feed files from a bad url, vulnerability report a log parse error otherwise they are imported correctly.

#### Test providers

- **[test_providers_enabled](test_providers/test_providers_enabled.md#test-providers-enabled)**: Tests that
modify the value of `enabled` tag in the configuration file and check the result in the logs file.

- **[test_providers_os](test_providers/test_providers_os.md#test-providers-os)**: Tests that modify the value of
`os` tag in the configuration file, set different `os` for Canonical and Debian, and check the result in the logs file.

- **[test_providers_update_from_year](test_providers/test_providers_update_from_year.md#test-providers-update-from-year)**:
Tests modify the value of `update_from_year` tag in the configuration file, set different years and check the result in
the logs file.

- **[test_providers_update_interval](test_providers/test_providers_update_interval.md#test-providers-update-interval)**:
Tests that modify the value of `interval` tag in the configuration file, set different time intervals and units, and check the
result in the logs file.

---

### Tier 2

#### Test feeds - GENERIC

- **[test_validate_feed_content](test_feeds/test_validate_feed_content.md#test-validate-feed-content)**:
Tests that download the feeds of all providers, verify the format of each feed is as expected and their content is also
`XML` or `JSON` parseable.

#### Test feeds - RHEL

- **[test_extra_fields_redhat_feed](test_feeds/redhat/test_extra_fields_redhat_feed.md#test-extra-fields-red-hat-feed)**:
Set of tests that check the behavior of vulnerability detector when there is any extra field in the feed.

- **[test_invalid_syntax_redhat_feed](test_feeds/redhat/test_invalid_syntax_redhat_feed.md#test-invalid-syntax-red-hat-feed)**:
Set of tests that check the behavior of Vulnerability Detector when the feed has some kind of syntactic error.

- **[test_invalid_values_redhat_feed](test_feeds/redhat/test_invalid_values_redhat_feed.md#test-invalid-values-red-hat-feed)**:
Set of tests that check the behavior of Vulnerability Detector when the value of a field is incorrect.

- **[test_missing_fields_redhat_feed](test_feeds/redhat/test_missing_fields_redhat_feed.md#test-missing-fields-red-hat-feed)**:
Set of tests that check the behavior of Vulnerability Detector when any field is missing from the feed.

#### Test feeds - CANONICAL

- **[test_extra_tags_canonical_feed](test_feeds/canonical/test_extra_tags_canonical_feed.md#test-extra-tags-canonical-feed)**:
Set of tests that check the behavior of Vulnerability Detector when there is any extra tag in the feed.

- **[test_invalid_syntax_canonical_feed](test_feeds/canonical/test_invalid_syntax_canonical_feed.md#test-invalid-syntax-canonical-feed)**:
Set of tests that check the behavior of Vulnerability Detector when the feed has some kind of syntactic error.

- **[test_invalid_values_canonical_feed](test_feeds/canonical/test_invalid_values_canonical_feed.md#test-invalid-values-canonical-feed)**:
Set of tests that check the behavior of Vulnerability Detector when the value of a tag is incorrect.

- **[test_missing_tags_canonical_feed](test_feeds/canonical/test_missing_tags_canonical_feed.md#test-missing-tags-canonical-feed)**:
Set of tests that check the behavior of Vulnerability Detector when any tag is missing from the feed.

#### Test feeds - DEBIAN

- **[test_extra_tags_debian_feed](test_feeds/debian/test_extra_tags_debian_feed.md#test-extra-tags-debian-feed)**:
Set of tests that check the behavior of Vulnerability Detector when there is any extra tag in the feed.

- **[test_invalid_syntax_debian_feed](test_feeds/debian/test_invalid_syntax_debian_feed.md#test-invalid-syntax-debian-feed)**:
Set of tests check the behavior of Vulnerability Detector when the feed has some kind of syntactic error.

- **[test_invalid_values_debian_feed](test_feeds/debian/test_invalid_values_debian_feed.md#test-invalid-values-debian-feed)**:
Set of tests that check the behavior of vulnerability detector when the value of a tag is not correct.

- **[test_missing_tags_debian_feed](test_feeds/debian/test_missing_tags_debian_feed.md#test-missing-tags-debian-feed)**:
Set of tests that check the behavior of Vulnerability Detector when any tag is missing from the feed.

#### Test feeds - AMAZON LINUX

- **[test_extra_tags_alas_feed](test_feeds/alas/test_extra_tags_alas_feed.md#test-extra-tags-alas-feed)**:
Set of tests that check the behavior of Vulnerability Detector when there is any extra tag in the feed.

- **[test_invalid_syntax_alas_feed](test_feeds/alas/test_invalid_syntax_alas_feed.md#test-invalid-syntax-alas-feed)**:
Set of tests check the behavior of Vulnerability Detector when the feed has some kind of syntactic error.

- **[test_invalid_values_alas_feed](test_feeds/alas/test_invalid_values_alas_feed.md#test-invalid-values-alas-feed)**:
Set of tests that check the behavior of vulnerability detector when the value of a tag is not correct.

- **[test_missing_tags_alas_feed](test_feeds/alas/test_missing_tags_alas_feed.md#test-missing-tags-alas-feed)**:
Set of tests that check the behavior of Vulnerability Detector when any tag is missing from the feed.
