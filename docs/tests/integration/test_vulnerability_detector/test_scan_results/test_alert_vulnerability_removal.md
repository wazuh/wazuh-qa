# Test alert vulnerability removal

The test will check if the Vulnerability Detector module generates an alert when a vulnerability 
is removed from the inventory.

## General info

|Tier | Number of tests | Time spent| Test file | 
|:--:|:--:|:--:|:--:| 
| 0 | 1 | 1m20s | test_alert_vulnerability_removal.py |

## Test logic

The manager is configured to use custom feeds with vulnerabilities associated with two test packages. 
Those packages will be inserted in a simulated agent and, after this, the necessary conditions 
will be provoked to launch a BASELINE scan type.

Once the scan is completed, we will verify that the vulnerabilities are added to the `vuln_cves` table. 
This will be verified by checking the logs file.

The next step is to create the two situations for which the vulnerability removal alert will be generated: 
**uninstalling** a vulnerable package and **updating** a vulnerable package to a non-vulnerable version.

Finally, the required conditions are created to start a `PARTIAL_SCAN` scan and, after it is finished, 
the alerts that should have been generated after the removal of the vulnerabilities are searched for.

## Checks

- [x] The `BASELINE` and `PARTIAL_SCAN` scan startup, checking messages in the logs file.
- [x] The NVD vulnerabilities for the test packages are detected during the scans, checking messages in the logs file.
- [x] Completion of the scans, checking messages in the logs file.
- [x] Alerts are generated both when uninstalling a vulnerable package and when updating a vulnerable package 
  to a non-vulnerable version, checking messages in the alerts file.

## Code documentation

::: tests.integration.test_vulnerability_detector.test_scan_results.test_alert_vulnerability_removal
