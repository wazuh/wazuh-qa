# Test missing tags SUSE feed

Set of tests to check the behavior of Vulnerability Detector when a tag is missing in the feed.

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 2 | 36  | 0:07:18 | [test_missing_tags_suse_feed.py](../../../test_feeds/suse/test_missing_tags_suse_feed.py)|

## Test logic

Each test consists of removing one of the following tags from the feed:

```
['generator', 'product_name', 'product_version', 'schema_version', 'timestamp',
 'definitions', 'definition', 'metadata', 'title', 'description', 'affected',
 'platform', 'reference', 'advisory', 'severity', 'public_date', 'bug', 'criteria',
 'extend_definition', 'criterion', 'tests', 'dpkginfo_test', 'test_object',
 'objects', 'dpkginfo_object', 'object_element', 'states', 'dpkginfo_state',
 'state_object', 'variables', 'constant_variable', 'variable_value']
```

## Tests

- `test_no_feed_changes`: Check the original feed is successfully imported.
- `test_missing_tags_suse_feed`: The tests are based on removing a certain tag from feed.

## Checks

- [x] The original feed is successfully imported.
- [x] Vulnerabilities are inserted into the `vulnerabilities` database.
- [x] Action status message displayed in `ossec.log`.
- [x] `wazuh-modulesd` is still running once the test has finished (it didn't crash).

## Observed behavior

The feed will not be imported if:

- There is a key tag missing:

  ```
  key_tags = ['definitions', 'definition', 'metadata', 'criteria', 'criterion', 'tests',
              'dpkginfo_test', 'test_object', 'dpkginfo_object', 'object_element',
              'dpkginfo_state', 'state_object', 'constant_variable', 'variable_value']
  ```

For other cases, the feed will be imported successfully.

**Comments**

Marked as **expected fail** when there is one of the following tags missing:

```
xfail_tags = ['definitions', 'metadata', 'reference', 'criteria']
```

due to vulnerabilities are not imported even though the opposite is logged in `ossec.log`.

> Note: **expected fail** means that you expect a test to fail for some reason. A common example is a test for a feature
not yet implemented, or a bug not yet fixed.

## Execution result

```
========================================== test session starts ==========================================
platform linux -- Python 3.6.8, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: /wazuh-qa/tests/integration, configfile: pytest.ini
plugins: testinfra-6.3.0, testinfra-6.0.0, metadata-1.11.0, html-2.0.1
collected 36 items

test_vulnerability_detector/test_feeds/suse/test_missing_tags_suse_feed.py ......x.x... [ 36%]
.x....x..x...........                                                                             [100%]

=============================== 32 passed, 4 xfailed in 438.05s (0:07:18) ===============================
```

## Code documentation

::: tests.integration.test_vulnerability_detector.test_feeds.suse.test_missing_tags_suse_feed
