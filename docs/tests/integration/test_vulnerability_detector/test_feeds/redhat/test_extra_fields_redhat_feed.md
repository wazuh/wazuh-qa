# Test extra fields Red Hat feed

Set of tests to check the behavior of Vulnerability Detector when there is an extra field in the feed.

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 2 | 122 | 0:21:28 | [test_extra_fields_redhat_feed.py](../../../test_feeds/redhat/test_extra_fields_redhat_feed.py)|

## Test logic

For each of the following values a new label `<x>y</x>` will be created.

```
[[1, 2, 3], {"a": 1, "b": 2}, "extra_tag", 12345, "ñ", "テスト", "ИСПЫТАНИЕ", "测试", "اختبار", " ", ""]
```

For instance:

```
<[1, 2, 3]>[1, 2, 3]</[1, 2, 3]>, <[1, 2, 3]>{"a": 1, "b": 2}</[1, 2, 3]>, ...
```

## Tests

- `test_no_feed_changes`: Check the original feed is successfully imported.
- `test_extra_fields_redhat_feed`: The tests are based on adding new labels formed by each value in test_data.

## Checks

- [x] The original feed is successfully imported.
- [x] Vulnerabilities are inserted into the `vulnerabilities` database.
- [x] Action status message displayed in `ossec.log`.
- [x] Check log event: `Unexpected JSON key`.
- [x] `wazuh-modulesd` is still running once the test has finished (it didn't crash).

## Observed behavior

The feed will be successfully imported if:

- The feed has not been modified.
- The type of inserted field is `string`.

For other cases, the feed will not be imported.

## Execution result

```
========================================== test session starts ==========================================
platform linux -- Python 3.6.8, pytest-5.4.1, py-1.8.1, pluggy-0.13.1
rootdir: /root/wazuh-qa/tests/integration, inifile: pytest.ini
plugins: metadata-1.8.0, html-2.0.1, testinfra-5.0.0
collected 122 items

test_vulnerability_detector/test_feeds/redhat/test_extra_fields_redhat_feed.py .................. [ 14%]
................................................................................................. [ 94%]
.......                                                                                           [100%]

=================================== 122 passed in 1288.24s (0:21:28) ====================================
```


## Code documentation

::: tests.integration.test_vulnerability_detector.test_feeds.redhat.test_extra_fields_redhat_feed
