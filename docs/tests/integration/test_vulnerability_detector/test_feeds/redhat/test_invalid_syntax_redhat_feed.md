# Test invalid syntax Red Hat feed

Set of tests to check the behavior of Vulnerability Detector when the feed has some kind of syntactic error: it doesn't
have a closing field, it's missing some character...

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 2 | 57 | 0:09:47 | [test_invalid_syntax_redhat_feed.py](../../../test_feeds/redhat/test_invalid_syntax_redhat_feed.py)|

## Test logic

A test is performed for each of the following cases:

- Delete `{`.
- Delete `}`.
- Add `{{`.
- Add `}}`.
- Add `{` in the middle of the feed.
- Add `}` in the middle of the feed.
- Add `{}` in the middle of the feed.
- Delete key:value comma `,`.
- Add a comma before value `key: ,value,`.
- Add a comma before any key-value `, key:value`.
- Add a comma at the end of vulnerability `,}`.
- Add a double comma after `key:value,,`.
- Add a double comma after list `value,,`
- Close a key with double quotation marks.
- Close value with double quotation marks.
- Replace a comma with a semicolon.
- Replace a colon with a semicolon.
- Missing open bracket.
- Missing close bracket.
- Delete some information.
- For each of the following characters, it has been replaced a `,` character after a field-value.

```
['.', ':', '@', '#', '*', '-', '_', "'", '"', '/', '=', 'ñ', 'ç', '+', '^',
 '!', '?', '%', '&', '`', '¿', '?', '(', ')', '|', 'º', '$', '½', '¬',  '!',
 '~', '¡', '[', ']', '{', '}']
```

## Tests

- `test_no_feed_changes`: Check the original feed is successfully imported.
- `test_invalid_syntax_redhat_feed`: The tests are based on modifying the feed causing syntax errors.

## Checks

- [x] The original feed is successfully imported.
- [x] Vulnerabilities are inserted into the `vulnerabilities` database.
- [x] Action status message displayed in `ossec.log`.
- [x] `wazuh-modulesd` is still running once the test has finished (it didn't crash).

## Observed behavior

The feed will be imported successfully if:

- Feed has not been modified (imported original feed).

For other cases, the feed will not be imported.

## Execution result

```
========================================== test session starts ==========================================
platform linux -- Python 3.6.8, pytest-5.4.1, py-1.8.1, pluggy-0.13.1
rootdir: /root/wazuh-qa/tests/integration, inifile: pytest.ini
plugins: metadata-1.8.0, html-2.0.1, testinfra-5.0.0
collected 57 items

test_vulnerability_detector/test_feeds/redhat/test_invalid_syntax_redhat_feed.py ................ [ 28%]
.........................................                                                         [100%]

==================================== 57 passed in 587.85s (0:09:47) =====================================
```


## Code documentation

::: tests.integration.test_vulnerability_detector.test_feeds.redhat.test_invalid_syntax_redhat_feed
