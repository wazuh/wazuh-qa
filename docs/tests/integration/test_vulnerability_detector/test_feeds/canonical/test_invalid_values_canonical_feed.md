# Test invalid values Canonical feed

Set of tests to check the behavior of Vulnerability Detector when the value of a tag is not correct: invalid type,
strange characters...

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 2 | 171 | 0:27:25 | [test_invalid_values_canonical_feed.py](../../../test_feeds/canonical/test_invalid_values_canonical_feed.py)|


## Test logic

First a list of labels is created whose value will be replaced. This list is composed of labels that are and are not
keys.

> Note: A key tag is one that needs to be present in the feed in order to be imported*

```
key_tags = ['definitions', 'definition', 'metadata', 'criteria', 'criterion', 'tests',
            'dpkginfo_test', 'test_object','dpkginfo_object', 'object_element',
            'dpkginfo_state', 'state_object', 'constant_variable', 'variable_value']

non_key_tags = ['product_name', 'affected', 'platform']
```

For each of these labels, a value is assigned from the following list:

```
[None, "", "dummy value", 12345, ['1', '2', '3', '4', '5'], "ñ", "テスト",
 "ИСПЫТАНИЕ", "测试", "اختبار"]
```

For example:

```
<definitions>None</definitions>, <definitions></definitions> ...
```

## Tests

- `test_no_feed_changes`: Check the original feed is successfully imported.
- `test_invalid_values_canonical_feed`: The tests are based on modifying the feed assigning strange values.

## Checks

- [x] Feed is imported successfully with the original feed.
- [x] Vulnerabilities are inserted into the `vulnerabilities` database.
- [x] Action status message displayed in `ossec.log`.
- [x] `Modulesd` is running after the test (don't crash).

## Observed behavior

The feed will not be imported if:

- The value changed is done in one of the following tags:

  ```
  ['definitions', 'definition', 'metadata', 'criteria', 'criterion', 'tests', 'dpkginfo_test']
  ```

For other cases, the feed will be imported successfully.

**Comments**

Marked as **expected fail** when `dpkginfo_test` is modified due to feed is not imported but the opposite is shown in
`ossec.log`. Related issue https://github.com/wazuh/wazuh/issues/5275

> Note: **expected fail** means that you expect a test to fail for some reason. A common example is a test for a feature
not yet implemented, or a bug not yet fixed.

## Execution result

```
========================================== test session starts ==========================================
platform linux -- Python 3.8.2, pytest-5.4.1, py-1.8.1, pluggy-0.13.1
rootdir: /root/wazuh-qa/tests/integration, inifile: pytest.ini
plugins: html-2.0.1, testinfra-5.0.0, metadata-1.8.0
collected 171 items

test_vulnerability_detector/test_feeds/canonical/test_invalid_values_canonical_feed.py .......... [  5%]
...................................................xxxxxxxxxx.................................... [ 62%]
................................................................                                  [100%]

============================= 161 passed, 10 xfailed in 1645.32s (0:27:25) ==============================
```

## Code documentation

::: tests.integration.test_vulnerability_detector.test_feeds.canonical.test_invalid_values_canonical_feed
