# Test invalid syntax Canonical feed

Set of tests that check the behavior of Vulnerability Detector when the feed has some kind of syntactic error such as
missing character or closing tag, etc.

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 2 | 83 | 0:13:16 | [test_invalid_syntax_canonical_feed.py](../../../test_feeds/canonical/test_invalid_syntax_canonical_feed.py)|

## Test logic

A test is performed for each of the following cases:

- Delete `<`.
- Delete `>`.
- Delete `<>`.
- Close initial tag.
- Delete opening tag.
- Delete closing tag.
- Empty opening tag.
- Empty closing tag.
- Random text before tag.
- Delete info.

In addition, It has been added new tests with different characters.

```
['.', ':', '@', '#', '*', '-', '_', "'", '"', '/', '=', 'ñ', 'ç', '+', '^',
 '!', '?', '%', '&', '`', '¿', '?', '(', ')', '|', 'º', '$', '½', '¬',  '!',
 '~', '¡', '[', ']', '{', '}']
```

In this case, for each of the following characters, a test is performed in which:
 - Replace the symbol `<` with the character.
 - Add the character before an opening tag (`<`).

## Tests

- `test_no_feed_changes`: Check the original feed is successfully imported.
- `test_invalid_syntax_canonical_feed`: The tests are based on modifying the feed causing syntax errors.

## Checks

- [x] Feed is imported successfully with the original feed.
- [x] Vulnerabilities are inserted into the `vulnerabilities` database.
- [x] Action status message displayed in `ossec.log`.
- [x] `wazuh-modulesd` is still running once the test has finished (it didn't crash).

## Observed behavior

The feed will not be imported if:

- Delete `<`.
- Delete `>`.
- Delete `<>`.
- Close initial tag.
- Delete opening tag.
- Delete closing tag.
- Empty opening tag.
- Empty closing tag.
- Delete info.
- Replace `<` with other character.

For other cases, the feed will be imported successfully.

## Execution result

```
========================================== test session starts ==========================================
platform linux -- Python 3.8.2, pytest-5.4.1, py-1.8.1, pluggy-0.13.1
rootdir: /root/wazuh-qa/tests/integration, inifile: pytest.ini
plugins: html-2.0.1, testinfra-5.0.0, metadata-1.8.0
collected 83 items

test_vulnerability_detector/test_feeds/canonical/test_invalid_syntax_canonical_feed.py .......... [ 12%]
.........................................................................                         [100%]

==================================== 83 passed in 796.10s (0:13:16) =====================================
```

## Code documentation


::: tests.integration.test_vulnerability_detector.test_feeds.canonical.test_invalid_syntax_canonical_feed
