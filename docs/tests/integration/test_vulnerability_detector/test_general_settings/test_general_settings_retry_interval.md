# Test general settings retry interval

The tests will modify the value of `retry_interval` tag in the configuration file,
setting different intervals and checking the result in the logs file.

## General info

|Tier | Number of tests | Time spent| Test file |
|:--:|:--:|:--:|:--:|
| 0 | 6 | 3m14s | test_general_settings_retry_interval.py |

## Test logic

For different time units:

```
['s']
```

and the time values:

```
[20, 30, 40]
```

At first, the test will check in the logs file if the following message appears:

```
<vulnerability_detector_prefix> Going to sleep <value> seconds before retrying pending agents
```

And then the test will look into the log file for the following message:

```
<vulnerability_detector_prefix> Analyzing OVAL vulnerabilities for agent '<agent_id>'
```

To do so, a simulated agent is added to the system, as soon as it is detected, the Vulnerability Detector
will attempt to start a (`BASELINE` scan) on it. Since the values in the table `sync_info` represent a not synced state
of `sys_programs` table, the agent is skipped.
The date when the agent was skipped plus the value set in `retry_interval` should be greater or equal to the date
that the vulnerabilities analysis starts on the agent after a synced state is forced modifying the info in `sync_info`.

## Checks

- [x] Vulnerability Detector does not attempt to start a scan of the agent until the time set in `retry_interval` has expired.

## Code documentation

::: tests.integration.test_vulnerability_detector.test_general_settings.test_general_settings_retry_interval
