# Copyright (C) 2015-2021, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is free software; you can redistribute it and/or modify it under the terms of GPLv2

import json
import os
import re

from jsonschema import validate

_data_path = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'data')


def validate_mitre_event(event):
    """
    Check if a Mitre event is properly formatted.

    Args:
        event (dict): event generated by rule enhanced by MITRE.
    """
    with open(os.path.join(_data_path, 'mitre_event.json'), 'r') as f:
        schema = json.load(f)
    validate(schema=schema, instance=event)


def callback_detect_mitre_event(line):
    """Callback to detect Mitre event

    Args:
        line (str): text to be compared with alerts in ossec.log

    Returns:
        dict: JSON object on success or None on fail
    """
    match = re.match(r'.*Ossec server started.*', line)
    if match:
        return json.loads(line)
    return None
